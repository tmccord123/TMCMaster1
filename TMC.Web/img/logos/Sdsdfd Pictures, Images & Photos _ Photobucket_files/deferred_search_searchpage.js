(function(e,t){"use strict";var n=e.History=e.History||{},r=e.jQuery;if(typeof n.Adapter!="undefined")throw new Error("History.js Adapter has already been loaded...");n.Adapter={bind:function(e,t,n){r(e).bind(t,n)},trigger:function(e,t,n){r(e).trigger(t,n)},extractEventData:function(e,n,r){var i=n&&n.originalEvent&&n.originalEvent[e]||r&&r[e]||t;return i},onDomLoad:function(e){r(e)}};typeof n.init!="undefined"&&n.init()})(window);(function(e,t){"use strict";var n=e.document,r=e.setTimeout||r,i=e.clearTimeout||i,s=e.setInterval||s,o=e.History=e.History||{};if(typeof o.initHtml4!="undefined")throw new Error("History.js HTML4 Support has already been loaded...");o.initHtml4=function(){if(typeof o.initHtml4.initialized!="undefined")return!1;o.initHtml4.initialized=!0;o.enabled=!0;o.savedHashes=[];o.isLastHash=function(e){var t=o.getHashByIndex(),n;n=e===t;return n};o.saveHash=function(e){if(o.isLastHash(e))return!1;o.savedHashes.push(e);return!0};o.getHashByIndex=function(e){var t=null;typeof e=="undefined"?t=o.savedHashes[o.savedHashes.length-1]:e<0?t=o.savedHashes[o.savedHashes.length+e]:t=o.savedHashes[e];return t};o.discardedHashes={};o.discardedStates={};o.discardState=function(e,t,n){var r=o.getHashByState(e),i;i={discardedState:e,backState:n,forwardState:t};o.discardedStates[r]=i;return!0};o.discardHash=function(e,t,n){var r={discardedHash:e,backState:n,forwardState:t};o.discardedHashes[e]=r;return!0};o.discardedState=function(e){var t=o.getHashByState(e),n;n=o.discardedStates[t]||!1;return n};o.discardedHash=function(e){var t=o.discardedHashes[e]||!1;return t};o.recycleState=function(e){var t=o.getHashByState(e);o.discardedState(e)&&delete o.discardedStates[t];return!0};if(o.emulated.hashChange){o.hashChangeInit=function(){o.checkerFunction=null;var t="",r,i,u,a;if(o.isInternetExplorer()){r="historyjs-iframe";i=n.createElement("iframe");i.setAttribute("id",r);i.style.display="none";n.body.appendChild(i);i.contentWindow.document.open();i.contentWindow.document.close();u="";a=!1;o.checkerFunction=function(){if(a)return!1;a=!0;var n=o.getHash()||"",r=o.unescapeHash(i.contentWindow.document.location.hash)||"";if(n!==t){t=n;if(r!==n){u=r=n;i.contentWindow.document.open();i.contentWindow.document.close();i.contentWindow.document.location.hash=o.escapeHash(n)}o.Adapter.trigger(e,"hashchange")}else if(r!==u){u=r;o.setHash(r,!1)}a=!1;return!0}}else o.checkerFunction=function(){var n=o.getHash();if(n!==t){t=n;o.Adapter.trigger(e,"hashchange")}return!0};o.intervalList.push(s(o.checkerFunction,o.options.hashChangeInterval));return!0};o.Adapter.onDomLoad(o.hashChangeInit)}if(o.emulated.pushState){o.onHashChange=function(t){var r=t&&t.newURL||n.location.href,i=o.getHashByUrl(r),s=null,u=null,a=null,f;if(o.isLastHash(i)){o.busy(!1);return!1}o.doubleCheckComplete();o.saveHash(i);if(i&&o.isTraditionalAnchor(i)){o.Adapter.trigger(e,"anchorchange");o.busy(!1);return!1}s=o.extractState(o.getFullUrl(i||n.location.href,!1),!0);if(o.isLastSavedState(s)){o.busy(!1);return!1}u=o.getHashByState(s);f=o.discardedState(s);if(f){o.getHashByIndex(-2)===o.getHashByState(f.forwardState)?o.back(!1):o.forward(!1);return!1}o.pushState(s.data,s.title,s.url,!1);return!0};o.Adapter.bind(e,"hashchange",o.onHashChange);o.pushState=function(t,r,i,s){if(o.getHashByUrl(i))throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(s!==!1&&o.busy()){o.pushQueue({scope:o,callback:o.pushState,args:arguments,queue:s});return!1}o.busy(!0);var u=o.createStateObject(t,r,i),a=o.getHashByState(u),f=o.getState(!1),l=o.getHashByState(f),c=o.getHash();o.storeState(u);o.expectedStateId=u.id;o.recycleState(u);o.setTitle(u);if(a===l){o.busy(!1);return!1}if(a!==c&&a!==o.getShortUrl(n.location.href)){o.setHash(a,!1);return!1}o.saveState(u);o.Adapter.trigger(e,"statechange");o.busy(!1);return!0};o.replaceState=function(e,t,n,r){if(o.getHashByUrl(n))throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(r!==!1&&o.busy()){o.pushQueue({scope:o,callback:o.replaceState,args:arguments,queue:r});return!1}o.busy(!0);var i=o.createStateObject(e,t,n),s=o.getState(!1),u=o.getStateByIndex(-2);o.discardState(s,i,u);o.pushState(i.data,i.title,i.url,!1);return!0}}o.emulated.pushState&&o.getHash()&&!o.emulated.hashChange&&o.Adapter.onDomLoad(function(){o.Adapter.trigger(e,"hashchange")})};typeof o.init!="undefined"&&o.init()})(window);(function(e,t){"use strict";var n=e.console||t,r=e.document,i=e.navigator,s=e.sessionStorage||!1,o=e.setTimeout,u=e.clearTimeout,a=e.setInterval,f=e.clearInterval,l=e.JSON,c=e.alert,h=e.History=e.History||{},p=e.history;l.stringify=l.stringify||l.encode;l.parse=l.parse||l.decode;if(typeof h.init!="undefined")throw new Error("History.js Core has already been loaded...");h.init=function(){if(typeof h.Adapter=="undefined")return!1;typeof h.initCore!="undefined"&&h.initCore();typeof h.initHtml4!="undefined"&&h.initHtml4();return!0};h.initCore=function(){if(typeof h.initCore.initialized!="undefined")return!1;h.initCore.initialized=!0;h.options=h.options||{};h.options.hashChangeInterval=h.options.hashChangeInterval||100;h.options.safariPollInterval=h.options.safariPollInterval||500;h.options.doubleCheckInterval=h.options.doubleCheckInterval||500;h.options.storeInterval=h.options.storeInterval||1e3;h.options.busyDelay=h.options.busyDelay||250;h.options.debug=h.options.debug||!1;h.options.initialTitle=h.options.initialTitle||r.title;h.intervalList=[];h.clearAllIntervals=function(){var e,t=h.intervalList;if(typeof t!="undefined"&&t!==null){for(e=0;e<t.length;e++)f(t[e]);h.intervalList=null}};h.debug=function(){(h.options.debug||!1)&&h.log.apply(h,arguments)};h.log=function(){var e=typeof n!="undefined"&&typeof n.log!="undefined"&&typeof n.log.apply!="undefined",t=r.getElementById("log"),i,s,o,u,a;if(e){u=Array.prototype.slice.call(arguments);i=u.shift();typeof n.debug!="undefined"?n.debug.apply(n,[i,u]):n.log.apply(n,[i,u])}else i="\n"+arguments[0]+"\n";for(s=1,o=arguments.length;s<o;++s){a=arguments[s];if(typeof a=="object"&&typeof l!="undefined")try{a=l.stringify(a)}catch(f){}i+="\n"+a+"\n"}if(t){t.value+=i+"\n-----\n";t.scrollTop=t.scrollHeight-t.clientHeight}else e||c(i);return!0};h.getInternetExplorerMajorVersion=function(){var e=h.getInternetExplorerMajorVersion.cached=typeof h.getInternetExplorerMajorVersion.cached!="undefined"?h.getInternetExplorerMajorVersion.cached:function(){var e=3,t=r.createElement("div"),n=t.getElementsByTagName("i");while((t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->")&&n[0]);return e>4?e:!1}();return e};h.isInternetExplorer=function(){var e=h.isInternetExplorer.cached=typeof h.isInternetExplorer.cached!="undefined"?h.isInternetExplorer.cached:Boolean(h.getInternetExplorerMajorVersion());return e};h.emulated={pushState:!Boolean(e.history&&e.history.pushState&&e.history.replaceState&&!/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(i.userAgent)&&!/AppleWebKit\/5([0-2]|3[0-2])/i.test(i.userAgent)),hashChange:Boolean(!("onhashchange"in e||"onhashchange"in r)||h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<8)};h.enabled=!h.emulated.pushState;h.bugs={setHash:Boolean(!h.emulated.pushState&&i.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(i.userAgent)),safariPoll:Boolean(!h.emulated.pushState&&i.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(i.userAgent)),ieDoubleCheck:Boolean(h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<7)};h.isEmptyObject=function(e){for(var t in e)return!1;return!0};h.cloneObject=function(e){var t,n;if(e){t=l.stringify(e);n=l.parse(t)}else n={};return n};h.getRootUrl=function(){var e=r.location.protocol+"//"+(r.location.hostname||r.location.host);if(r.location.port||!1)e+=":"+r.location.port;e+="/";return e};h.getBaseHref=function(){var e=r.getElementsByTagName("base"),t=null,n="";if(e.length===1){t=e[0];n=t.href.replace(/[^\/]+$/,"")}n=n.replace(/\/+$/,"");n&&(n+="/");return n};h.getBaseUrl=function(){var e=h.getBaseHref()||h.getBasePageUrl()||h.getRootUrl();return e};h.getPageUrl=function(){var e=h.getState(!1,!1),t=(e||{}).url||r.location.href,n;n=t.replace(/\/+$/,"").replace(/[^\/]+$/,function(e,t,n){return/\./.test(e)?e:e+"/"});return n};h.getBasePageUrl=function(){var e=r.location.href.replace(/[#\?].*/,"").replace(/[^\/]+$/,function(e,t,n){return/[^\/]$/.test(e)?"":e}).replace(/\/+$/,"")+"/";return e};h.getFullUrl=function(e,t){var n=e,r=e.substring(0,1);t=typeof t=="undefined"?!0:t;/[a-z]+\:\/\//.test(e)||(r==="/"?n=h.getRootUrl()+e.replace(/^\/+/,""):r==="#"?n=h.getPageUrl().replace(/#.*/,"")+e:r==="?"?n=h.getPageUrl().replace(/[\?#].*/,"")+e:t?n=h.getBaseUrl()+e.replace(/^(\.\/)+/,""):n=h.getBasePageUrl()+e.replace(/^(\.\/)+/,""));return n.replace(/\#$/,"")};h.getShortUrl=function(e){var t=e,n=h.getBaseUrl(),r=h.getRootUrl();t=t.replace(r,"/");h.isTraditionalAnchor(t)&&(t="./"+t);t=t.replace(/^(\.\/)+/g,"./").replace(/\#$/,"");return t};h.store={};h.idToState=h.idToState||{};h.stateToId=h.stateToId||{};h.urlToId=h.urlToId||{};h.storedStates=h.storedStates||[];h.savedStates=h.savedStates||[];h.normalizeStore=function(){h.store.idToState=h.store.idToState||{};h.store.urlToId=h.store.urlToId||{};h.store.stateToId=h.store.stateToId||{}};h.getState=function(e,t){typeof e=="undefined"&&(e=!0);typeof t=="undefined"&&(t=!0);var n=h.getLastSavedState();!n&&t&&(n=h.createStateObject());if(e){n=h.cloneObject(n);n.url=n.cleanUrl||n.url}return n};h.getIdByState=function(e){var t=h.extractId(e.url),n;if(!t){n=h.getStateString(e);if(typeof h.stateToId[n]!="undefined")t=h.stateToId[n];else if(typeof h.store.stateToId[n]!="undefined")t=h.store.stateToId[n];else{for(;;){t=(new Date).getTime()+String(Math.random()).replace(/\D/g,"");if(typeof h.idToState[t]=="undefined"&&typeof h.store.idToState[t]=="undefined")break}h.stateToId[n]=t;h.idToState[t]=e}}return t};h.normalizeState=function(e){var t,n;if(!e||typeof e!="object")e={};if(typeof e.normalized!="undefined")return e;if(!e.data||typeof e.data!="object")e.data={};t={};t.normalized=!0;t.title=e.title||"";t.url=h.getFullUrl(h.unescapeString(e.url||r.location.href));t.hash=h.getShortUrl(t.url);t.data=h.cloneObject(e.data);t.id=h.getIdByState(t);t.cleanUrl=t.url.replace(/\??\&_suid.*/,"");t.url=t.cleanUrl;n=!h.isEmptyObject(t.data);if(t.title||n){t.hash=h.getShortUrl(t.url).replace(/\??\&_suid.*/,"");/\?/.test(t.hash)||(t.hash+="?");t.hash+="&_suid="+t.id}t.hashedUrl=h.getFullUrl(t.hash);(h.emulated.pushState||h.bugs.safariPoll)&&h.hasUrlDuplicate(t)&&(t.url=t.hashedUrl);return t};h.createStateObject=function(e,t,n){var r={data:e,title:t,url:n};r=h.normalizeState(r);return r};h.getStateById=function(e){e=String(e);var n=h.idToState[e]||h.store.idToState[e]||t;return n};h.getStateString=function(e){var t,n,r;t=h.normalizeState(e);n={data:t.data,title:e.title,url:e.url};r=l.stringify(n);return r};h.getStateId=function(e){var t,n;t=h.normalizeState(e);n=t.id;return n};h.getHashByState=function(e){var t,n;t=h.normalizeState(e);n=t.hash;return n};h.extractId=function(e){var t,n,r;n=/(.*)\&_suid=([0-9]+)$/.exec(e);r=n?n[1]||e:e;t=n?String(n[2]||""):"";return t||!1};h.isTraditionalAnchor=function(e){var t=!/[\/\?\.]/.test(e);return t};h.extractState=function(e,t){var n=null,r,i;t=t||!1;r=h.extractId(e);r&&(n=h.getStateById(r));if(!n){i=h.getFullUrl(e);r=h.getIdByUrl(i)||!1;r&&(n=h.getStateById(r));!n&&t&&!h.isTraditionalAnchor(e)&&(n=h.createStateObject(null,null,i))}return n};h.getIdByUrl=function(e){var n=h.urlToId[e]||h.store.urlToId[e]||t;return n};h.getLastSavedState=function(){return h.savedStates[h.savedStates.length-1]||t};h.getLastStoredState=function(){return h.storedStates[h.storedStates.length-1]||t};h.hasUrlDuplicate=function(e){var t=!1,n;n=h.extractState(e.url);t=n&&n.id!==e.id;return t};h.storeState=function(e){h.urlToId[e.url]=e.id;h.storedStates.push(h.cloneObject(e));return e};h.isLastSavedState=function(e){var t=!1,n,r,i;if(h.savedStates.length){n=e.id;r=h.getLastSavedState();i=r.id;t=n===i}return t};h.saveState=function(e){if(h.isLastSavedState(e))return!1;h.savedStates.push(h.cloneObject(e));return!0};h.getStateByIndex=function(e){var t=null;typeof e=="undefined"?t=h.savedStates[h.savedStates.length-1]:e<0?t=h.savedStates[h.savedStates.length+e]:t=h.savedStates[e];return t};h.getHash=function(){var e=h.unescapeHash(r.location.hash);return e};h.unescapeString=function(t){var n=t,r;for(;;){r=e.unescape(n);if(r===n)break;n=r}return n};h.unescapeHash=function(e){var t=h.normalizeHash(e);t=h.unescapeString(t);return t};h.normalizeHash=function(e){var t=e.replace(/[^#]*#/,"").replace(/#.*/,"");return t};h.setHash=function(e,t){var n,i,s;if(t!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.setHash,args:arguments,queue:t});return!1}n=h.escapeHash(e);h.busy(!0);i=h.extractState(e,!0);if(i&&!h.emulated.pushState)h.pushState(i.data,i.title,i.url,!1);else if(r.location.hash!==n)if(h.bugs.setHash){s=h.getPageUrl();h.pushState(null,null,s+"#"+n,!1)}else r.location.hash=n;return h};h.escapeHash=function(t){var n=h.normalizeHash(t);n=e.escape(n);h.bugs.hashEscape||(n=n.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?"));return n};h.getHashByUrl=function(e){var t=String(e).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");t=h.unescapeHash(t);return t};h.setTitle=function(e){var t=e.title,n;if(!t){n=h.getStateByIndex(0);n&&n.url===e.url&&(t=n.title||h.options.initialTitle)}try{r.getElementsByTagName("title")[0].innerHTML=t.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(i){}r.title=t;return h};h.queues=[];h.busy=function(e){typeof e!="undefined"?h.busy.flag=e:typeof h.busy.flag=="undefined"&&(h.busy.flag=!1);if(!h.busy.flag){u(h.busy.timeout);var t=function(){var e,n,r;if(h.busy.flag)return;for(e=h.queues.length-1;e>=0;--e){n=h.queues[e];if(n.length===0)continue;r=n.shift();h.fireQueueItem(r);h.busy.timeout=o(t,h.options.busyDelay)}};h.busy.timeout=o(t,h.options.busyDelay)}return h.busy.flag};h.busy.flag=!1;h.fireQueueItem=function(e){return e.callback.apply(e.scope||h,e.args||[])};h.pushQueue=function(e){h.queues[e.queue||0]=h.queues[e.queue||0]||[];h.queues[e.queue||0].push(e);return h};h.queue=function(e,t){typeof e=="function"&&(e={callback:e});typeof t!="undefined"&&(e.queue=t);h.busy()?h.pushQueue(e):h.fireQueueItem(e);return h};h.clearQueue=function(){h.busy.flag=!1;h.queues=[];return h};h.stateChanged=!1;h.doubleChecker=!1;h.doubleCheckComplete=function(){h.stateChanged=!0;h.doubleCheckClear();return h};h.doubleCheckClear=function(){if(h.doubleChecker){u(h.doubleChecker);h.doubleChecker=!1}return h};h.doubleCheck=function(e){h.stateChanged=!1;h.doubleCheckClear();h.bugs.ieDoubleCheck&&(h.doubleChecker=o(function(){h.doubleCheckClear();h.stateChanged||e();return!0},h.options.doubleCheckInterval));return h};h.safariStatePoll=function(){var t=h.extractState(r.location.href),n;if(!h.isLastSavedState(t)){n=t;n||(n=h.createStateObject());h.Adapter.trigger(e,"popstate");return h}return};h.back=function(e){if(e!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.back,args:arguments,queue:e});return!1}h.busy(!0);h.doubleCheck(function(){h.back(!1)});p.go(-1);return!0};h.forward=function(e){if(e!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.forward,args:arguments,queue:e});return!1}h.busy(!0);h.doubleCheck(function(){h.forward(!1)});p.go(1);return!0};h.go=function(e,t){var n;if(e>0)for(n=1;n<=e;++n)h.forward(t);else{if(!(e<0))throw new Error("History.go: History.go requires a positive or negative integer passed.");for(n=-1;n>=e;--n)h.back(t)}return h};if(h.emulated.pushState){var d=function(){};h.pushState=h.pushState||d;h.replaceState=h.replaceState||d}else{h.onPopState=function(t,n){var i=!1,s=!1,o,u;h.doubleCheckComplete();o=h.getHash();if(o){u=h.extractState(o||r.location.href,!0);if(u)h.replaceState(u.data,u.title,u.url,!1);else{h.Adapter.trigger(e,"anchorchange");h.busy(!1)}h.expectedStateId=!1;return!1}i=h.Adapter.extractEventData("state",t,n)||!1;i?s=h.getStateById(i):h.expectedStateId?s=h.getStateById(h.expectedStateId):s=h.extractState(r.location.href);s||(s=h.createStateObject(null,null,r.location.href));h.expectedStateId=!1;if(h.isLastSavedState(s)){h.busy(!1);return!1}h.storeState(s);h.saveState(s);h.setTitle(s);h.Adapter.trigger(e,"statechange");h.busy(!1);return!0};h.Adapter.bind(e,"popstate",h.onPopState);h.pushState=function(t,n,r,i){if(h.getHashByUrl(r)&&h.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(i!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.pushState,args:arguments,queue:i});return!1}h.busy(!0);var s=h.createStateObject(t,n,r);if(h.isLastSavedState(s))h.busy(!1);else{h.storeState(s);h.expectedStateId=s.id;p.pushState(s.id,s.title,s.url);h.Adapter.trigger(e,"popstate")}return!0};h.replaceState=function(t,n,r,i){if(h.getHashByUrl(r)&&h.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(i!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.replaceState,args:arguments,queue:i});return!1}h.busy(!0);var s=h.createStateObject(t,n,r);if(h.isLastSavedState(s))h.busy(!1);else{h.storeState(s);h.expectedStateId=s.id;p.replaceState(s.id,s.title,s.url);h.Adapter.trigger(e,"popstate")}return!0}}if(s){try{h.store=l.parse(s.getItem("History.store"))||{}}catch(v){h.store={}}h.normalizeStore()}else{h.store={};h.normalizeStore()}h.Adapter.bind(e,"beforeunload",h.clearAllIntervals);h.Adapter.bind(e,"unload",h.clearAllIntervals);h.saveState(h.storeState(h.extractState(r.location.href,!0)));if(s){h.onUnload=function(){var e,t;try{e=l.parse(s.getItem("History.store"))||{}}catch(n){e={}}e.idToState=e.idToState||{};e.urlToId=e.urlToId||{};e.stateToId=e.stateToId||{};for(t in h.idToState){if(!h.idToState.hasOwnProperty(t))continue;e.idToState[t]=h.idToState[t]}for(t in h.urlToId){if(!h.urlToId.hasOwnProperty(t))continue;e.urlToId[t]=h.urlToId[t]}for(t in h.stateToId){if(!h.stateToId.hasOwnProperty(t))continue;e.stateToId[t]=h.stateToId[t]}h.store=e;h.normalizeStore();s.setItem("History.store",l.stringify(e))};h.intervalList.push(a(h.onUnload,h.options.storeInterval));h.Adapter.bind(e,"beforeunload",h.onUnload);h.Adapter.bind(e,"unload",h.onUnload)}if(!h.emulated.pushState){h.bugs.safariPoll&&h.intervalList.push(a(h.safariStatePoll,h.options.safariPollInterval));if(i.vendor==="Apple Computer, Inc."||(i.appCodeName||"")==="Mozilla"){h.Adapter.bind(e,"hashchange",function(){h.Adapter.trigger(e,"popstate")});h.getHash()&&h.Adapter.onDomLoad(function(){h.Adapter.trigger(e,"hashchange")})}}};h.init()})(window);$.getObject("Pb.History",!0).HistoryManager=function(){function e(){this.init()}var t={pageState:{},pageTitle:null,pageUrl:null,init:function(){this.bindEvents()},bindEvents:function(){$(document).on("HistoryManager::updatePageHistory",$.proxy(function(e){this.updatePageHistory(e)},this))},updatePageHistory:function(e){var t=e.replace?!0:!1;e.state&&this.setCurrentState(e.state);e.url&&this.setPageUrl(e.url);e.title&&this.setPageTitle(e.title);this.updateState(t)},updateState:function(e){if(typeof History!="undefined")try{e?History.replaceState(this.pageState,this.pageTitle,this.pageUrl):History.pushState(this.pageState,this.pageTitle,this.pageUrl)}catch(t){typeof console!="undefined"&&console.log(t)}},collapseEmail:function(e){if(e.indexOf("/images/")!==-1){var t=e.split("/images/"),n=t[t.length-1];t[t.length-1]=n.replace(/[\@|\.]/gi,"");e=t.join("/images/")}return e},setCurrentState:function(e){this.pageState=e},setPageUrl:function(e){e.indexOf("@")!==-1&&(e=this.collapseEmail(e));this.pageUrl=e},setPageTitle:function(e){this.pageTitle=e}};e.prototype=t;return e}();$.getObject("Pb.History",!0).HistoryManager=new Pb.History.HistoryManager;$.getObject("Pb.Data",!0).Collection=function(){function e(e){this.init(e)}var t=500,n=e.prototype;n.init=function(e){var t={cacheFull:!1,offset:0,items:[],currentCollection:!0,currentPage:-1,identifier:"collection_"+(new Date).getTime(),collectionId:null},n,r=[];this.data={};this.hydrated=!0;this.mergeData(t);e&&this.mergeData(e);this.collectionDataForLinking=[this.data];if(this.getProperty("pbdkey")){n=Pb.Data.Shared.get(this.getProperty("pbdkey"));n||Pb.Data.Shared.put(this.getProperty("pbdkey"),r);this.itemsDataForLinking=r}else this.itemsDataForLinking=[];this.pageDataForLinking=[]};n.getData=function(){return this.data};n.getProperty=function(e){return this.data.hasOwnProperty(e)?this.data[e]:null};n.setProperty=function(e,t){this.hasProperty("currentCollection")?$.observable(this.data).setProperty(e,t):this.data[e]=t;return this};n.hasProperty=function(e){return this.data.hasOwnProperty(e)};n.getCollectionId=function(){return this.getProperty("collectionId")||this.getProperty("identifier")};n.getIdentifier=function(){return this.getProperty("identifier")};n.mergeData=function(e){if(!e)return;var t;for(t in e)e.hasOwnProperty(t)&&this.setProperty(t,e[t])};n.getItems=function(){return this.data.items};n.addItems=function(e,t){var n,r;if(!e||!e.length){r=$.Deferred();r.resolve()}else{t?n=0:n=this.getProperty("offset");this.hasProperty("pbdkey")&&Pb.Data.Shared.sync(this.getProperty("pbdkey"),e);t?this.setProperty("offset",e.length):this.setProperty("offset",this.getItems().length+e.length);r=this.updateItems(e,null,t||n===0);r.done($.proxy(function(){this.triggerItemsAdded(n)},this))}return r};n.addItemsAtIndex=function(e,t){var n,r,i,s=[],o=this.getItems(),u=o.length;if(!e||!e.length){r=$.Deferred();r.resolve()}else{this.hasProperty("pbdkey")&&Pb.Data.Shared.sync(this.getProperty("pbdkey"),e);if(t>=u){for(i=u;i<t;i++)s.push(null);this.getProperty("currentCollection")&&(u===0?$.observable(this.getLinkableCollectionItemsData()).refresh(s):$.observable(this.getLinkableCollectionItemsData()).insert(u,s));u===0?this.data.items=s:[].splice.apply(o,[u,0].concat(s));this.setProperty("offset",u+s.length)}else{this.getProperty("currentCollection")&&$.observable(this.getLinkableCollectionItemsData()).remove(t,e.length);o.splice(t,e.length)}r=this.updateItems(e,t,!1,r);r.done($.proxy(function(){this.triggerItemsAdded(n)},this))}return r};n.updateItems=function(e,t,n,r){var i=30,s=e.slice(0,e.length),o,u;o=s.splice(0,i);t===null&&(n?t=0:t=this.getItems().length);r||(r=$.Deferred());if(n){this.getProperty("currentCollection")&&$.observable(this.getLinkableCollectionItemsData()).refresh(o);this.data.items=o}else{this.getProperty("currentCollection")&&$.observable(this.getLinkableCollectionItemsData()).insert(t,o);[].splice.apply(this.getItems(),[t,0].concat(o))}this.updateItemOffsets(t);if(s.length>0)this.refreshItemsTimer=setTimeout($.proxy(function(){this.updateItems(s,t+i,!1,r)},this),50);else{u=this.getItems().length;this.setProperty("offset",u);this.hasProperty("total")&&u>=this.getProperty("total")?this.setProperty("cacheFull",!0):this.setProperty("cacheFull",!1);r.resolve()}return r};n.removeItem=function(e){this.removeItems([e])};n.removeItems=function(e){function h(e,t){return e-t}var t=this.getItems(),n,r,i,s,o,u,a=[],f={},l=[],c=-1;e=e.sort(h);for(s=0;s<e.length;s++)if(c>=0&&c+f[c]===e[s])f[c]++;else{f[e[s]]=1;l.push(e[s]);c=e[s]}l=l.sort(h).reverse();for(s=0;s<l.length;s++){u=l[s];for(o=0;o<f[u];o++)a.push(t[u+o]);if(this.getProperty("currentCollection")){$.observable(this.getLinkableCollectionItemsData()).remove(u,f[u]);if(n>=0){r=(n-1)*this.getPageSize();i=r+this.getNumberOfItemsOnPage(n);r<=f[u]&&f[u]<i&&$.observable(this.getLinkableCollectionPageData()).remove(u,f[u])}}t.splice(u,f[u])}this.updateItemOffsets(u);this.getProperty("cacheFull")?this.setProperty("total",this.getProperty("total")-a.length).setProperty("offset",t.length):this.setProperty("total",this.getProperty("total")-a.length).setProperty("offset",this.getProperty("offset")-a.length);this.setProperty("itemsCount",this.getProperty("itemsCount")-a.length);this.triggerItemsRemoved(u,a);return this};n.insertItems=function(e,t){var n=this.getItems(),r;if(this.hydrated&&e<=n.length){$.isArray(t)||(t=[t]);this.getProperty("total")&&this.setProperty("total",this.getProperty("total")+t.length);r=this.updateItems(t,e);r.done($.proxy(function(){this.setProperty("itemsCount",this.getProperty("itemsCount")+t.length);this.triggerItemsAdded(e,t.length)},this))}else{this.setProperty("itemsCount",this.getProperty("itemsCount")+t.length);this.triggerItemsAdded(e,t.length)}return this};n.updateItemOffsets=function(e){var t,n,r=this.getItems();if(this.getProperty("currentCollection")){t=this.getLinkableCollectionItemsData();for(n=e;n<t.length;n++)t[n]&&$.observable(t[n]).setProperty("offset",n)}for(n=e;n<r.length;n++)r[n]&&r[n].offset&&(r[n].offset=n)};n.triggerItemsAdded=function(e,t){$(document).trigger($.Event("CollectionData::itemsAdded",{identifier:this.getIdentifier(),offset:e,itemsCount:this.getProperty("itemsCount"),numberOfItems:t}))};n.triggerItemsRemoved=function(e,t){$(document).trigger($.Event("CollectionData::itemsRemoved",{identifier:this.getIdentifier(),offset:e,itemsCount:this.getProperty("itemsCount"),items:t}))};n.getPageSize=function(){return this.getProperty("pageSize")};n.getCurrentPage=function(){return this.getProperty("currentPage")};n.getTotalPages=function(){var e=this.getProperty("total"),t=Math.ceil(e/this.getPageSize());return t};n.paginate=function(e){e>0&&e<=this.getTotalPages()&&this.setCurrentPageData(e)};n.appendPage=function(e){if(e>0&&e<=this.getTotalPages()){if(this.getProperty("currentCollection")){var t=this.getPageData(e);t&&$.observable(this.getLinkableCollectionPageData()).refresh(this.getItems())}$(document).trigger("CollectionData::PageData")}};n.prependPage=function(e){if(e>0&&e<=this.getTotalPages()){if(this.getProperty("currentCollection")){var t=this.getPageData(e),n=(e-1)*this.getPageSize();t&&$.observable(this.getLinkableCollectionPageData()).insert(n,t)}$(document).trigger("CollectionData::PageData")}};n.setCurrentPageData=function(e){if(this.getProperty("currentCollection")){var t=this.getPageData(e);if(t&&t.length){$.observable(this.getLinkableCollectionPageData()).refresh(t);this.setProperty("currentPage",e);$(document).trigger("CollectionData::PageData")}}};n.checkPageData=function(e){var t=this.getPageSize(),n=t*(e-1),r=n+this.getNumberOfItemsOnPage(e),i,s;if(!this.hasProperty("total"))return!1;if(this.getProperty("total")===0)return!0;if(e>this.getTotalPages())return!1;i=this.getPageData(e);if(!i)return!1;if(i.length!==r-n)return!1;for(s=0;s<i.length;s++)if(i[s]===null||!i[s].id)return!1;return!0};n.getPageData=function(e){var t=this.getPageSize(),n=t*(e-1),r=n+this.getNumberOfItemsOnPage(e),i;if(e>this.getTotalPages())return null;i=this.getItems().slice(n,r);return i};n.getNumberOfItemsOnPage=function(e){var t=this.getPageSize(),n=this.getProperty("total"),r=t*(e-1),i=r+t;if(e>this.getTotalPages())return null;i>n&&(i=n);return i-r};n.addPlaceholdersForPage=function(e,t){if(!this.checkPageData(e)){var n=this.getPageSize()*(e-1),r=n+this.getNumberOfItemsOnPage(e),i,s=[],o=this.getItems().length,u,a=this.getItems();if(r>=o){for(i=o;i<r;i++){t.offset=i;s.push(t)}u=o;this.setProperty("offset",r+s.length)}else{for(i=n;i<r;i++){t.offset=i;s.push(t)}this.getProperty("currentCollection")&&$.observable(this.getLinkableCollectionItemsData()).remove(n,s.length);a.splice(n,s.length);u=n}this.getProperty("currentCollection")&&$.observable(this.getLinkableCollectionItemsData()).insert(u,s);[].splice.apply(a,[u,0].concat(s))}};n.truncateCache=function(){return this.truncateCacheToN(t)};n.truncateCacheToN=function(e){var t=this.getItems(),n;if(this.getProperty("offset")>e){n=this.getProperty("offset")-e;this.setProperty("offset",e).setProperty("cacheFull",!1);if(e===0){if(this.getProperty("currentCollection")){$.observable(this.getLinkableCollectionItemsData()).refresh([]);$.observable(this.getLinkableCollectionPageData()).refresh([])}this.data.items=[]}else{this.getProperty("currentCollection")&&$.observable(this.getLinkableCollectionItemsData()).remove(e,n);t.splice(e,n)}}return this};n.getLinkableCollectionData=function(){return this.collectionDataForLinking};n.getLinkableCollectionItemsData=function(){return this.itemsDataForLinking};n.getLinkableCollectionPageData=function(){return this.pageDataForLinking};return e}();(function(){function e(){var e=$("#noResultsSearchForm"),t=e.find(".searchAction"),n=function(t){t.preventDefault();var n=e.find("#q"),r=e.find("#type"),i=n.val();if(i!==""){var s=r.val(),o="/"+s+"/"+encodeURIComponent(i);document.location=o}return!1};if(typeof History!="undefined"){if($("#detailModal").is(":visible"))return;History.replaceState({},document.title,window.location.pathname.replace(/[\@|\.]|(\%40)/gi,""))}t.click(n);e.submit(n)}Pb.InitEventQueue.addToDomReady(e,10)})();(function(e,t,n){"use strict";var r=t.event,i;r.special.smartresize={setup:function(){t(this).bind("resize",r.special.smartresize.handler)},teardown:function(){t(this).unbind("resize",r.special.smartresize.handler)},handler:function(e,t){var n=this,r=arguments;e.type="smartresize";i&&clearTimeout(i);i=setTimeout(function(){jQuery.event.handle.apply(n,r)},t==="execAsap"?0:100)}};t.fn.smartresize=function(e){return e?this.bind("smartresize",e):this.trigger("smartresize",["execAsap"])};t.Mason=function(e,n){this.element=t(n);this._create(e);this._init()};t.Mason.settings={isResizable:!0,isAnimated:!1,animationOptions:{queue:!1,duration:500},gutterWidth:0,isRTL:!1,isFitWidth:!1,containerStyle:{position:"relative"}};t.Mason.prototype={_filterFindBricks:function(e){var t=this.options.itemSelector;return t?e.filter(t).add(e.find(t)):e},_getBricks:function(e){var t=this._filterFindBricks(e).css({position:"absolute"}).addClass("masonry-brick");return t},_create:function(n){this.options=t.extend(!0,{},t.Mason.settings,n);this.styleQueue=[];var r=this.element[0].style;this.originalStyle={height:r.height||""};var i=this.options.containerStyle;for(var s in i)this.originalStyle[s]=r[s]||"";this.element.css(i);this.horizontalDirection=this.options.isRTL?"right":"left";this.offset={x:parseInt(this.element.css("padding-"+this.horizontalDirection),10),y:parseInt(this.element.css("padding-top"),10)};this.isFluid=this.options.columnWidth&&typeof this.options.columnWidth=="function";var o=this;setTimeout(function(){o.element.addClass("masonry")},0);this.options.isResizable&&t(e).bind("smartresize.masonry",function(){o.resize()});this.reloadItems()},_init:function(e){this._getColumns();this._reLayout(e)},option:function(e,n){t.isPlainObject(e)&&(this.options=t.extend(!0,this.options,e))},layout:function(e,t){for(var n=0,r=e.length;n<r;n++)this._placeBrick(e[n]);var i={};i.height=Math.max.apply(Math,this.colYs);if(this.options.isFitWidth){var s=0;n=this.cols;while(--n){if(this.colYs[n]!==0)break;s++}i.width=(this.cols-s)*this.columnWidth-this.options.gutterWidth}this.styleQueue.push({$el:this.element,style:i});var o=this.isLaidOut?this.options.isAnimated?"animate":"css":"css",u=this.options.animationOptions,a;for(n=0,r=this.styleQueue.length;n<r;n++){a=this.styleQueue[n];a.$el[o](a.style,u)}this.styleQueue=[];t&&t.call(e);this.isLaidOut=!0},_getColumns:function(){var e=this.options.isFitWidth?this.element.parent():this.element,t=e.width();this.columnWidth=this.isFluid?this.options.columnWidth(t):this.options.columnWidth||this.$bricks.outerWidth(!0)||t;this.columnWidth+=this.options.gutterWidth;this.cols=Math.floor((t+this.options.gutterWidth)/this.columnWidth);this.cols=Math.max(this.cols,1)},_placeBrick:function(e){var n=t(e),r,i,s,o,u;r=Math.ceil(n.outerWidth(!0)/(this.columnWidth+this.options.gutterWidth));r=Math.min(r,this.cols);if(r===1)s=this.colYs;else{i=this.cols+1-r;s=[];for(u=0;u<i;u++){o=this.colYs.slice(u,u+r);s[u]=Math.max.apply(Math,o)}}var a=Math.min.apply(Math,s),f=0;for(var l=0,c=s.length;l<c;l++)if(s[l]===a){f=l;break}var h={top:a+this.offset.y};h[this.horizontalDirection]=this.columnWidth*f+this.offset.x;this.styleQueue.push({$el:n,style:h});var p=a+n.outerHeight(!0),d=this.cols+1-c;for(l=0;l<d;l++)this.colYs[f+l]=p},resize:function(){var e=this.cols;this._getColumns();(this.isFluid||this.cols!==e)&&this._reLayout()},_reLayout:function(e){var t=this.cols;this.colYs=[];while(t--)this.colYs.push(0);this.layout(this.$bricks,e)},reloadItems:function(){this.$bricks=this._getBricks(this.element.children())},reload:function(e){this.reloadItems();this._init(e)},appended:function(e,t,n){if(t){this._filterFindBricks(e).css({top:this.element.height()});var r=this;setTimeout(function(){r._appended(e,n)},1)}else this._appended(e,n)},_appended:function(e,t){var n=this._getBricks(e);this.$bricks=this.$bricks.add(n);this.layout(n,t)},remove:function(e){this.$bricks=this.$bricks.not(e);e.remove()},destroy:function(){this.$bricks.removeClass("masonry-brick").each(function(){this.style.position="";this.style.top="";this.style.left=""});var n=this.element[0].style;for(var r in this.originalStyle)n[r]=this.originalStyle[r];this.element.unbind(".masonry").removeClass("masonry").removeData("masonry");t(e).unbind(".masonry")}};t.fn.imagesLoaded=function(e){function u(){e.call(n,r)}function a(e){var n=e.target;if(n.src!==s&&t.inArray(n,o)===-1){o.push(n);if(--i<=0){setTimeout(u);r.unbind(".imagesLoaded",a)}}}var n=this,r=n.find("img").add(n.filter("img")),i=r.length,s="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",o=[];i||u();r.bind("load.imagesLoaded error.imagesLoaded",a).each(function(){this.src.indexOf("?")>-1?this.src+="&"+(new Date).getTime():this.src+="?"+(new Date).getTime()});return n};var s=function(t){e.console&&e.console.error(t)};t.fn.masonry=function(e){if(typeof e=="string"){var n=Array.prototype.slice.call(arguments,1);this.each(function(){var r=t.data(this,"masonry");if(!r){s("cannot call methods on masonry prior to initialization; attempted to call method '"+e+"'");return}if(!t.isFunction(r[e])||e.charAt(0)==="_"){s("no such method '"+e+"' for masonry instance");return}r[e].apply(r,n)})}else this.each(function(){var n=t.data(this,"masonry");if(n){n.option(e||{});n._init()}else t.data(this,"masonry",new t.Mason(e,this))});return this}})(window,jQuery);$.getObject("Pb.Component.Recent",!0).ThumbnailList=function(){function e(e){this.init(e)}var t=new Pb.ThumbnailListBase,n,r={pbDataKey:null,fetchParams:null,fetchServiceUrl:null,container:"",templateTarget:null,user:Pb.Data.Shared.get("loggedInUser"),adCount:1,promoAdCount:1,likesQueryTemplate:null,queryTemplate:null,ic:null,objects:[],query:null,offset:null,total:null,firstFetch:!0,mktgAd:null,init:function(e){this.mktgAd=Pb.Data.get("marketingAd");var t=this,n=new Image;t.mktgAd&&(n.src=t.mktgAd.imageUrl);this.tab=e.tab;this.renderTarget=$("#recentThumbnailList");this.masonryOptions={itemSelector:".blockItem",containerStyle:{"margin-bottom":"15px",display:"inline-block",position:"relative",width:"100%",height:"100%"},gutterWidth:5,columnWidth:function(e){var n=(e-15)/4;n<=300&&(n=(e-10)/3);t.renderTarget.find(t.masonryOptions.itemSelector+".mktContainer").css("width",n*2+5);t.renderTarget.find(t.masonryOptions.itemSelector+" img.mktImg").height(250);t.renderTarget.find(t.masonryOptions.itemSelector+" img:not(.avatar, .mktImg), "+t.masonryOptions.itemSelector+".mrecContainer, "+t.masonryOptions.itemSelector+".promoContainer").css("width",n);return n}};this.pbDataKey=e.pbDataKey;this.ic=e.ic;this.ic.setTrackContext("lihp_"+this.tab);this.query=this.ic.query;this.templateTarget=e.templateTarget;this.container=e.container;this.thumbSize=e.thumbSize;this.pageSize=e.pageSize||this.ic.pageSize;this.likesQueryTemplate="filters[user]=__USERID__&filters[likes]=1&sort=3&limit="+this.pageSize+"&recent_activity=true";this.queryTemplate="filters[user]=__USERID__&filters[recent]=1&sort=1&limit="+this.pageSize;this.initEvents();var r=Pb.Data.Shared.get(this.pbDataKey);if(r){this.appendToObjects(r);this.offset=18;this.configureInfiniteCollection();this.fetchRecent()}},initEvents:function(){var e=this;e.renderTarget.imagesLoaded(function(){e.renderTarget.masonry(e.masonryOptions)});$(window).on("resize",$.throttle(1e3,function(){e.renderTarget.masonry("reload")}));this.attachTabHandlers();var t=$(".recentActivityHeader .nav-tabs");t.find("#youruploadsTab").on("click",$.proxy(this.onClickYourUploads,this));t.find("#trendingTab").on("click",$.proxy(this.onClickTrending,this));t.find("#likesTab").on("click",$.proxy(this.onClickLikes,this));$("#loadMore").on("click",$.proxy(this.onLoadMoreClick,this));this.ic.onLoadMoreViaQuery=$.proxy(this.onLoadMoreViaQuery,this)},attachTabHandlers:function(){$(".recentActivityHeader .nav-tabs li a").on("click",function(e){var t=$(e.currentTarget),r=t.closest("li");r.siblings(".active").removeClass("active");r.parent().find(".tab-divider").remove();n=40;t.is("#trendingTab")&&r.next().append('<div class="tab-divider"></div>');r.addClass("active")})},configureInfiniteCollection:function(){this.ic.reset(this.offset,this.total,this.query,$.proxy(this.onLoadMoreViaQuery,this))},fetchRecent:function(){var e=Pb.Data.Shared.get(this.pbDataKey);(!this.total||e.length<this.total)&&this.ic.loadMore()},resetCollection:function(e){this.abortLastXhr();e=e||!1;this.renderTarget.addClass("emptyView");this.firstFetch=!0;this.resetObjects([]);this.offset=0;this.total=0;this.ic.setTrackContext("lihp_"+this.tab);if(!e){this.ic.reset(this.offset,this.total,this.query,$.proxy(this.onLoadMoreViaQuery,this));this.fetchRecent()}$("#loadMore").addClass("hide")},onClickTrending:function(){this.tab="trending";Pb.Track.tr("lihp_tab_"+this.tab+"_click");Pb.PageTracker.trackContentRefreshPageView({pb_pg:"recent:trending"});this.query=this.likesQueryTemplate.replace("__USERID__",Pb.Data.get("trendingUserId"));this.resetCollection()},onClickYourUploads:function(){this.tab="youruploads";Pb.Track.tr("lihp_tab_"+this.tab+"_click");Pb.PageTracker.trackContentRefreshPageView({pb_pg:"recent:uploads"});this.query=this.queryTemplate.replace("__USERID__",Pb.Data.get("userId"));this.resetCollection()},onClickLikes:function(){this.tab="likes";Pb.Track.tr("lihp_tab_"+this.tab+"_click");Pb.PageTracker.trackContentRefreshPageView({pb_pg:"recent:uploads"});this.query=this.likesQueryTemplate.replace("__USERID__",Pb.Data.get("userId"));this.resetCollection()},onImageHover:function(e){var t=$(e.currentTarget);t.find(".overlay").fadeIn("fast")},onImageMouseLeave:function(e){var t=$(e.currentTarget);t.find(".overlay").fadeOut("fast")},onThumbnailClick:function(e){Pb.Track.tr("lihp_"+this.tab+"_thumbnail_click")},onOwnerClick:function(e){Pb.Track.tr("lihp_"+this.tab+"_profile_click")},onLoadMoreClick:function(){this.ic.resume();this.ic.loadMore()},onLoadMoreViaQuery:function(e){this.fetchParams={offset:e,size:this.thumbSize,pageSize:this.pageSize*2,limit:this.pageSize*2};this.fetchServiceUrl=this.tab==="youruploads"?"/component/Activity-RecentThumbnailList?"+this.query:"/component/Likes-LikesThumbnailList?"+this.query;this.fetchMoreContent()},onObjectsAppended:function(e){var t=this,n=e.length;this.offset+=n;if(!this.firstFetch){if(!(n>0||this.total>0)){var r;$("#loadMore").addClass("hide");this.tab==="youruploads"?r=Pb.JSTemplates.render("#recentThumbnailListYourUploadsEmptyTemplate"):this.tab==="likes"&&(r=Pb.JSTemplates.render("#recentThumbnailListYourLikesEmptyTemplate"));t.renderTarget.append(r);t.insertMarketingAd("#recentThumbnailList .emptyBlock");t.insertAds(0,"#recentThumbnailList .placeHolderItem");$("#loadingMore").addClass("hide");return}t.renderTarget.removeClass("emptyView")}t.renderTarget.find(".basicWallThumbnail").each(function(e,t){var n=$(t).find("a.thumbnailLink"),r="&";if(n.attr("href").indexOf("&o=")===-1&&n.attr("href").indexOf("?o=")===-1){n.attr("href").indexOf("?")===-1&&(r="?");n.attr("href",n.attr("href")+r+"o="+n.parent().attr("data-pbdoffset"))}});t.renderTarget.find(".basicWallThumbnail").on("mouseenter",$.proxy(this.onImageHover,this));t.renderTarget.find(".basicWallThumbnail").on("mouseleave",$.proxy(this.onImageMouseLeave,this));t.renderTarget.find(".basicWallThumbnail .thumbnailLink").on("click",$.proxy(this.onThumbnailClick,this));t.renderTarget.find(".basicWallThumbnail .userLink").on("click",$.proxy(this.onOwnerClick,this));t.renderTarget.imagesLoaded(function(){t.insertMarketingAd("#recentThumbnailList .basicWallThumbnail");t.insertAds(1,"#recentThumbnailList .basicWallThumbnail");t.renderTarget.find(".basicWallThumbnail").fadeIn("fast");t.ic.moreLoaded(n);t.renderTarget.masonry("reload");n&&$("#loadMore").removeClass("hide")})},insertMarketingAd:function(e){if(this.mktgAd){var t=$("#recentThumbnailList").find(".mktContainer").length;t||$(e).after(function(e){if(e===0)return $("<div class='blockItem mktContainer'><div class='mktWrapper'><a href='"+Pb.Data.get("marketingAd").linkUrl+"' onclick="+Pb.Data.get("marketingAd").javascriptSnippet+"><img class='mktImg' src='"+Pb.Data.get("marketingAd").imageUrl+"'/></a></div></div>")})}},insertAds:function(e,t){if(!!Pb.Data.get("showAds")){var n=$("#recentThumbnailList").find(".mrecContainer").length,r=0,i=this;$(t).before(function(t){if(t===e){e+=i.pageSize;if(r>=n){var s=$("<div class='blockItem mrecContainer'><div class='mrecWrapper' data-loaded='no'></div></div>");try{s.find(".mrecWrapper").html(Pb.Component.Ad.AdRefresh.populateFromUrlOnly("mrec",i.adCount));i.adCount++}catch(o){s.find(".mrecWrapper").html("")}return s}r++}})}},insertPromoAds:function(e,t){var n=$("#recentThumbnailList").find(".promoContainer").length,r=0,i=this;$(t).after(function(t){if(t===e){e+=i.pageSize;if(r>=n){var s=$("<div class='blockItem promoContainer'><div class='promoWrapper' data-loaded='no'></div></div>");try{s.find(".promoWrapper").html(Pb.Component.Ad.AdRefresh.populateFromUrlOnly("promoAd",i.promoAdCount));i.promoAdCount++}catch(o){s.find(".promoWrapper").html("")}return s}r++}})},appendToObjects:function(e){if(!this.linked){Pb.JSTemplates.link(this.templateTarget,this.container,Pb.Data.Shared.get(this.pbDataKey));this.linked=!0}this.onObjectsAppended(e)},handleFetchMoreContent:function(e){this.total=e.total;this.ic.total=this.total;this.total===0&&$("#recentThumbnailList").addClass("emptyView");this.firstFetch=!1;this.appendToObjects(e.objects)}};$.views.helpers({isLoggedIn:function(){return Pb.Data.get("isLoggedIn")},ownerUsername:function(){return Pb.Data.get("ownerUsername")},viewerOrOwner:function(e){var t=Pb.Data.get("loggedInUser").username||"",n=Pb.Data.get("ownerUsername");if(e==="have")return t===n?"you haven't":n+" hasn't";if(e==="do")return t===n?"You don't":n+" doesn't"}});$.extend(e.prototype,r,t);return e}();$.getObject("Pb.Component.Media.Delete",!0).DeleteMediaModal=function(){function e(){e.superclass.constructor.call(this)}var t={init:function(t){var n={eventName:"DeleteMediaModal::show",modalId:"#deleteMediaModal",modalName:"deleteMediaModal",shownEvent:"DeleteMediaModal::shown",hideEvent:"DeleteMediaModal::hidden",submitButtonId:"#deleteMediaSubmitButton",submitUrl:"/action/media/delete",showProgress:!0,refreshAdsOnHide:!0,progressText:"This may take a moment. Hang tight."};t&&$.extend(n,t);e.superclass.init.call(this,n);this.initEvents()},initEvents:function(){$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:".deleteMediaAction",eventType:"click",event:this.eventName}}))},onFilmstripItemRemove:function(t,n){e.superclass.onFilmstripItemRemove.call(this,t,n);this.updateTitle()},buildSubmitData:function(){var e=$(this.modalId).find("> form [name=mediaPath]"),t=[];e.each(function(){t.push($(this).val())});return{mediaPath:t}},onShow:function(t){Pb.Data.get(this.modalName).media=Pb.Data.Shared.getData(t.pbEventTarget);e.superclass.onShow.call(this,t);this.modalData=t.pbData;this.refreshOnSuccess=!0;t.hasOwnProperty("refreshOnSuccess")&&(this.refreshOnSuccess=t.refreshOnSuccess);this.updateTitle()},updateTitle:function(){var e=$(this.modalId).find("form"),t=[],n,r=[],i,s,o;if($.isArray(this.modalData))for(i=0;i<this.modalData.length;i++){t.push(this.modalData[i].titleOrFilename);r.push(this.modalData[i].path)}else{t.push(this.modalData.titleOrFilename);r.push(this.modalData.path)}t.length===1?n="'"+t[0]+"'":n="the selected "+t.length+" photos or videos";o=this.modalData.mediaType;n=unescape(n.replace(/\+/g," "));$("#deleteMediaTitle").text(n);$("#deleteMediaPronoun").text(o);$(this.modalId).find("input[name=mediaPath]").remove();for(i=0;i<r.length;i++){s=$('<input type="hidden" name="mediaPath" />');s.val(r[i]);e.append(s)}},onSuccess:function(e){e.status===1&&(!this.refreshOnSuccess||Pb.Data.Albums?$(document).trigger("MediaDelete::deleteMediaCompleted",e.data):location.href=e.data.destinationUrl)}};Pb.subclass(e,Pb.Component.Element.Modal,t);var n=new e;n.init();return n}();$.getObject("Pb.Component.Element",!0).Filmstrip=function(){function e(){this.init.apply(this,arguments)}var t={properties:{},init:function(e){$.extend(this.properties,e);this.initEvents()},initEvents:function(){$.views.tags("thumbnailAction",{template:this.properties.itemActionTemplate});$.views.tags("filmstripAction",{template:this.properties.filmstripActionTemplate});$.views.helpers({getCountFromKey:function(e){return Pb.Data.Shared.get(e)?Pb.Data.Shared.get(e).length:0}});$(document).one(this.properties.initEvent,$.proxy(function(e){this.initFilmstrip(e)},this));$(document).one(this.properties.hideEvent,$.proxy(function(e){this.hideFilmstrip(e)},this))},initFilmstrip:function(e){if(Pb.Data.get(this.properties.pbdKey)){this.filmstrip=$("#"+this.properties.id);this.filmstripWrapper=$("#"+this.properties.id+"Wrapper");this.itemWidth=this.filmstrip.find(".filmstrip-item:first").outerWidth(!0);this.totalItems=Pb.Data.get(this.properties.pbdKey).length;this.filmstripWidth=this.totalItems*this.itemWidth;if(this.properties.showPagination){this.filmstrip.find(".filmstrip-wrapper").width(this.filmstripWidth);setTimeout($.proxy(function(){this.viewportWidth=this.filmstrip.outerWidth(!0);this.totalItems>Math.floor(this.viewportWidth/this.itemWidth)&&this.filmstrip.find(".filmstrip-next").show()},this),500)}this.filmstripWrapper.on("click."+this.properties.id+" touchstart."+this.properties.id,".filmstrip-next",$.proxy(this.next,this)).on("click."+this.properties.id+" touchstart."+this.properties.id,".action",$.proxy(this.triggerAction,this)).on("click."+this.properties.id+" touchstart."+this.properties.id,".filmstrip-prev",$.proxy(this.prev,this));Modernizr.touch&&this.initializeTouch();this.properties.context==="organizer"&&$(document).on("OrganizerThumbnails::selectedChanged."+this.properties.id,$.throttle(250,$.proxy(function(e){this.filmstripWrapper.find(".filmstrip-actions #selectedCount").html(e.selected)},this)))}},hideFilmstrip:function(e){$(document).off("."+this.properties.id);this.filmstripWrapper&&this.filmstripWrapper.off("."+this.properties.id);this.filmstrip&&this.filmstrip.find(".filmstrip-viewport").off("."+this.properties.id)},prev:function(){var e=this.getPrev();this.filmstrip.find(".filmstrip-wrapper").animate({left:e+"px"},"slow","linear",$.proxy(this.setArrows(e),this))},next:function(){var e=this.getNext();this.filmstrip.find(".filmstrip-wrapper").animate({left:e+"px"},"slow","linear",$.proxy(this.setArrows(e),this))},getPrev:function(){var e=parseInt(this.filmstrip.find(".filmstrip-wrapper").css("left"),10);isNaN(e)&&(e=0);e+=this.properties.scrollingItems*this.itemWidth;e*-1<=0&&(e=0);return e},getNext:function(){var e=parseInt(this.filmstrip.find(".filmstrip-wrapper").css("left"),10);isNaN(e)&&(e=0);e-=this.properties.scrollingItems*this.itemWidth;(e-this.viewportWidth)*-1>=this.filmstripWidth&&(e=(this.filmstripWidth-this.viewportWidth)*-1);return e},setArrows:function(e){e<0?this.filmstrip.find(".filmstrip-prev").show():this.filmstrip.find(".filmstrip-prev").hide();(e-this.viewportWidth)*-1>=this.filmstripWidth?this.filmstrip.find(".filmstrip-next").hide():this.filmstrip.find(".filmstrip-next").show()},onRemove:function(){if(this.properties.showPagination){this.filmstripWidth=this.itemWidth*this.filmstrip.find(".filmstrip-item").length;this.filmstrip.find(".filmstrip-wrapper").width(this.filmstripWidth);this.viewportWidth=this.filmstrip.outerWidth(!0);var e=parseInt(this.filmstrip.find(".filmstrip-wrapper").css("left"),10);this.setArrows(e)}},triggerAction:function(e){var t=$(e.currentTarget).data("type");switch(t){case"remove":var n=$(e.currentTarget).closest(".filmstrip-item");n.fadeOut(500,$.proxy(function(){n.remove();this.onRemove()},this));break;default:}this.filmstripWrapper.trigger($.Event("Pb.Component.Element.Filmstrip::"+t),{filmstripItem:e.currentTarget})},initializeTouch:function(){mm={};mm.swipeTreshold=100;mm.allowedTime=300;this.filmstrip.find(".filmstrip-viewport").on("touchstart."+this.properties.id,$.proxy(function(e){if(e.originalEvent.touches==undefined)var t=e;else var t=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];mm.ox=t.pageX;mm.oy=t.pageY;mm.startTime=(new Date).getTime()},this)).on("touchend."+this.properties.id,$.proxy(function(e){if(e.originalEvent.touches==undefined)var t=e;else var t=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];mm.dx=t.pageX-mm.ox;mm.dy=t.pageY-mm.oy;mm.endTime=(new Date).getTime()-mm.startTime;mm.dx<-mm.swipeTreshold&&mm.endTime<mm.allowedTime?this.next():mm.dx>mm.swipeTreshold&&mm.endTime<mm.allowedTime&&this.prev()},this))}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Media.CopyMove",!0).CopyMoveMediaModal=function(){function e(){e.superclass.constructor.call(this)}var t={copy:!0,location:null,destUrl:null,chooser:null,init:function(t){var n={eventName:"CopyMoveMediaModal::show",shownEvent:"CopyMoveMediaModal::shown",hideEvent:"CopyMoveMediaModal::hidden",modalId:"#copyMoveMediaModal",modalName:"copyMoveMediaModal",submitButtonId:"#copyMoveMediaSubmitButton",showProgress:!0,refreshAdsOnHide:!0,progressText:"This may take a moment. Hang tight."};t&&$.extend(n,t);e.superclass.init.call(this,n);this.initEvents(n)},onFilmstripItemRemove:function(t,n){e.superclass.onFilmstripItemRemove.call(this,t,n);this.modalData=Pb.Data.get(Pb.Data.Shared.SELECTED_SET);$(this.modalId).find("#copymoveLabel").html(this.getLabel())},initEvents:function(e){$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:".copyMoveMediaAction",eventType:"click",event:e.eventName}}))},buildSubmitData:function(){var e=$("#copyMoveMediaSubdomain").val(),t=$(this.modalId).find("> form [name=mediaUrl]"),n;this.copy?this.submitUrl="/action/media/copy":this.submitUrl="/action/media/move";n=[];t.each(function(){n.push($(this).val())});var r={mediaUrl:n,albumUrl:this.destUrl};$.extend(r,this.buildCreateAlbumData());return r},buildCreateAlbumData:function(){if(!$("#editAlbumModalEmbed").is(":visible"))return;var e={parentAlbumPath:$(this.modalId).find("#editAlbumChooser .dropdown-toggle").attr("data-albumpath"),name:$("#editAlbumTitle").val(),description:$("#editAlbumDescription").val(),vanityName:$("#editAlbumVanity").val(),reloadPage:this.notify?!1:!0,hashtag:$(".createHashtagSectionContent #createHashtag").length&&$(".createHashtagSectionContent #createHashtag").val().length?$(".createHashtagSectionContent #createHashtag").val():!1};e.privacyLevel=$(".privacySelectionContainer li.active a").attr("data-privacy");var t=this.getPrivacyPassword();if(e.privacyLevel==="password"&&t!==this.albumPrivacyPassword){var n,r=/^[\w-]{6,50}$/;if($.trim(t)===""){n={status:0,message:"",details:this.passwordMsg};Pb.Component.Element.Message.show(n);return!1}if(!r.test(t)){n={status:0,message:"",details:this.passwordMsg};Pb.Component.Element.Message.show(n);this.showProgress=!1;return!1}e.privacyPassword=t}return e},getPrivacyPassword:function(){var e="";$(".privacyPasswordContainer #privacyPassword").is(":visible")&&(e=$(".privacyPasswordContainer #privacyPassword").val());return e},onShow:function(t){Pb.Data.get(this.modalName)&&(Pb.Data.get(this.modalName).media=Pb.Data.Shared.getData(t.pbEventTarget));this.modalData=t.pbData;$.isArray(this.modalData)||(this.modalData=[this.modalData]);var n=Pb.Data.get("isLoggedIn");if(!n){$(document).trigger({type:"LoginModal::show",action:this.getButtonLabel(),k:this.modalData[0].pbdkey,o:this.modalData[0].offset});return}this.determineMode(t.pbEventTarget);t.headerTitle=this.getHeaderTitle();this.refreshOnSuccess=!0;t.hasOwnProperty("refreshOnSuccess")&&(this.refreshOnSuccess=t.refreshOnSuccess);this.bulkAction=!1;t.hasOwnProperty("bulkAction")&&(this.bulkAction=t.bulkAction);var r=Pb.Data.get(this.modalName);r.filmstrip.thumbUrl=t.pbData.thumbUrl;r.filmstrip.offset=t.pbData.offset;r.media||(r.media=t.pbData);Pb.Data.data.copyMoveMediaModal=r;t.modalData=r;e.superclass.onShow.call(this,t);var i=$("#copyMoveMediaAlbumChooser");i.on("AlbumChooserDropdown::albums_loading.copyMoveMediaModal",$.proxy(this.onAlbumsLoading,this));i.on("AlbumChooserDropdown::albums_loaded.copyMoveMediaModal",$.proxy(this.onAlbumsLoaded,this));i.on("AlbumChooserDropdown::album_selected.copyMoveMediaModal",$.proxy(this.onAlbumSelected,this));var s=Pb.Data.get("currentAlbum");this.chooser=new Pb.Component.Album.Chooser.AlbumChooserDropdown({albumChooserId:"#copyMoveMediaAlbumChooser",createAlbum:!0,createNewAlbum:function(e){e.preventDefault();$("#copyMoveMediaAlbumChooser .dropdown-toggle").html("<b class='caret'></b> <span>"+$("#copyMoveMediaAlbumChooser .createAlbum").text()+"</span>");$("#editAlbumModalEmbed").show();$("#copyMoveMediaSubmitButton").attr("disabled",!1);var t={mode:"create",notify:!0,embed:!0,notifyOnTitleChange:!0,isTagged:!1,leftRailClick:!1};$(document).trigger($.Event("Pb.Component.Album.Edit::show",t));setTimeout(function(){$(window).trigger("resize.modal")},250)},filter:"none"});this.loadAlbums(this.getAlbumPath())},loadAlbums:function(e){$("#copyMoveMediaSubmitButton").val(this.getButtonLabel()).attr("disabled",!0);this.chooser.loadAlbums(e)},onAlbumsLoading:function(){$("#copyMoveMediaAlbumChooser .dropdown").hide()},onAlbumsLoaded:function(){$("#copyMoveMediaAlbumChooser .dropdown").show();this.chooser.setSelectedAlbum()},onAlbumSelected:function(e){this.destUrl=e.albumData.albumurl;$("#editAlbumModalEmbed").hide();$("#copyMoveMediaSubmitButton").attr("disabled",!1)},onSuccess:function(e){if(e.status===1)if(!this.refreshOnSuccess||Pb.Data.Albums){var t="CopyMoveMediaModal::moveSuccess";this.copy&&(t="CopyMoveMediaModal::copySuccess");$(document).trigger({type:t,response:e});e.data.album&&e.data.album.path&&$(document).trigger("EditAlbum::createAlbumCompleted",e.data.album)}else{var n=e.data.destinationUrl;location.host.indexOf("media.")>=0&&(n=location.protocol+"//"+location.host.replace("media.","")+n);location.href=n}},determineMode:function(e){var t=$(e);if(typeof t!="object"){this.copy=!0;return}var n=t.data("copymovemode");n?this.copy=n==="move"?!1:!0:this.copy=t.text().toLowerCase()==="move"?!1:!0},getHeaderTitle:function(e){return this.copy?"Copy to album":"Move to album"},prepareDataForTemplate:function(e){e.label=this.getLabel();e.mediaUrls=this.getMediaUrls();e.albumPath=this.getAlbumPath();e.copy=this.copy;return e},getLabel:function(){var e="Where do you want to ",t,n=[],r;this.copy?e+="copy ":e+="move ";for(r=0;r<this.modalData.length;r++)n.push(this.modalData[r].titleOrFilename);n.length===1?t="'"+n[0]+"'":t="the selected "+n.length+" photos or videos";t=unescape(t.replace(/\+/g," "));e+=t;e+=" to?";return e},getMediaUrls:function(){var e,t,n=[];for(e=0;e<this.modalData.length;e++){t=this.modalData[e].fullsizeUrl;n.push(t)}return n},getAlbumPath:function(){return this.modalData.length>0?this.modalData[0].albumPath:null},getButtonLabel:function(){return this.copy?"Copy":"Move"}};Pb.subclass(e,Pb.Component.Element.Modal,t);var n=new e;n.init();return n}();$.getObject("Pb.Component.Share",!0).ShareModal=function(){function e(){e.superclass.constructor.call(this)}var t,n={currentController:null,privacy:null,linkTitle:null,init:function(t){var n={eventName:"Pb.Component.Share.ShareModal::show",shownEvent:"Pb.Component.Share.ShareModal::shown",hideEvent:"Pb.Component.Share.ShareModal::hidden",modalId:"#shareModal",modalName:"shareModal",showProgress:!0,refreshAdsOnHide:!0};t&&$.extend(n,t);e.superclass.init.call(this,n);this.initEvents(n);Pb.InitEventQueue.addToPageLoad(function(){if(Pb.Data.get("shareModal")&&Pb.Data.get("shareModal").isSponsoredEdit&&Pb.Data.get(Pb.Data.Shared.MEDIA).io){Pb.Data.get(Pb.Data.Shared.MEDIA).spedit=!0;$("#detailActions #facebook").click()}})},initEvents:function(e){$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:".shareModalAction",eventType:"click",event:e.eventName}}))},onShow:function(t){var n=t.pbData,r=t.shareMode,s=t.shareType,o=t.showPrint,u=t.pbEventTarget,a=t.url,f,l=!0;if(Pb.Data.get("shareModal").isSponsoredEdit&&Pb.Data.get(Pb.Data.Shared.MEDIA).spedit){Pb.Data.get("shareModal").socialShare.mediaDefaultMessage=Pb.Data.get("shareModal").sponsoredShareMessage;Pb.Data.get("shareModal").email.mediaDefaultMessage=Pb.Data.get("shareModal").sponsoredShareMessage;Pb.Data.get("shareModal").sponsor=Pb.Data.get("shareModal").sponsoredClass;Pb.Track.tr("share_modal_"+Pb.Data.get("shareModal").sponsoredClass+"_editor_view")}else{Pb.Data.get("shareModal").sponsor="";Pb.Data.get("shareModal").socialShare.mediaDefaultMessage=Pb.Data.get("shareModal").shareMessage;Pb.Data.get("shareModal").email.mediaDefaultMessage=Pb.Data.get("shareModal").shareMessage}r||(r=$(u).closest("[data-sharemode]").data("sharemode"));s||(s=$(u).closest("[data-sharetype]").data("sharetype"));if(!n&&$(".showingRecent").length){n=Pb.Data.Albums.getRootAlbum();n.slideshowUrl=null;n.data.url+="?view=recent";n.url=n.data.url;n.type="recent";this.privacy="Public";n.ownername=Pb.Data.get("libraryOwner")}r==="story"&&(n.items=Pb.Data.Shared.get("shared.albumStorySet"));if(!n&&($("#hashtagsSettings .hashtag").length||$(".emptyHashtagView").length)){r="hashtag";n={};n.slideshowUrl=null;n.url=a;$(".emptyHashtagView").length?n.hashtag=$(".emptyHashtagView").find(".hashtagLabel").text():n.hashtag=$("#hashtagsSettings .hashtag").text();this.privacy="Public";l=!1}n&&n.url&&n.url.length&&!n.fullsizeUrl&&(n.fullsizeUrl=n.url);f=this.getTitle(r,n);t.headerTitle=f;t.modalData={title:f,shareMode:r,shareType:s,shareObject:n,pbEventTarget:u};r==="story"&&(n.url=n.storyUrl);if(s==="gplus"){Pb.Component.Common.Social.GooglePlus.open(n.url,"share");return}if(s==="pinterest"){Pb.Component.Common.Social.Pinterest.open(n.url,"share",n.thumbUrl);return}if(s==="tumblr"){Pb.Component.Common.Social.Tumblr.open(t.modalData,"share");return}e.superclass.onShow.call(this,t);$(".spinner").hide();var c=$(this.modalId);c.on("hide",function(){Pb.Data.data.shareModal.tabs.activeTab="social"});t.embed&&(c=$(this.embedId));$("#patentMessage").hide();r==="story"&&$("#patentMessage").show();t.embed?Pb.Track.tr("share_embed_"+r+"_view"):Pb.Track.tr("share_modal_"+r+"_view");$("#printPromotion").hide();if(o){if(n.mediaType==="image"){var h=n.fullsizeUrl.split(".").pop().toLowerCase();if(h!=="gif"){$("#printPromotion").show();$("#framedPromoLink").attr("href","/print/homedecor/framedprints?media="+encodeURI(n.path));$("#canvasPromoLink").attr("href","/print/homedecor/canvasprints?media="+encodeURI(n.path));$(".promoImage").attr("style","background-image: url('"+n.fullsizeUrl+"');")}}}else if(r==="media"||r==="search")$("#printPromotion").hide();else if(n.items){var p,d=n.items;for(i=0;i<d.length;i++){p=d[i];if(p===null)continue;if(p.mediaType==="image"||r==="slideshow"){var h=p.fullsizeUrl.split(".").pop().toLowerCase();if(h!=="gif"&&(p.isOwner||p.cd||n.cd)){$("#printPromotion").show();$("#framedPromoLink").attr("href","/print/homedecor/framedprints?album="+encodeURI(n.path));$("#canvasPromoLink").attr("href","/print/homedecor/canvasprints?album="+encodeURI(n.path));$(".promoImage").attr("style","background-image: url('"+p.fullsizeUrl+"');");break}}}}else $("#printPromotion").hide();c.find(".nav-tabs a#email").attr("data-target","#"+c.attr("id")+" #shareModal_email");c.find(".nav-tabs a#social").attr("data-target","#"+c.attr("id")+" #shareModal_social");c.find(".nav-tabs a").on("shown",$.proxy(function(e){var t=$(e.currentTarget).data("tabtype");Pb.Data.data.shareModal.tabs.activeTab=t;switch(t){case"email":this.currentController=Pb.Component.Share.Email;$(document).trigger($.Event("Pb.Component.Share.ShareModal::emailTabShown",{modal:c.attr("id")}));break;case"followers":this.currentController=Pb.Component.Share.Followers;$(document).trigger($.Event("Pb.Component.Share.ShareModal::followersTabShown",{modal:c.attr("id")}));break;case"social":this.currentController=Pb.Component.Share.SocialShare;$(document).trigger($.Event("Pb.Component.Share.ShareModal::socialTabShown",{modal:c.attr("id")}));break;case"links":this.currentController=Pb.Component.Share.SocialShare;$(document).trigger($.Event("Pb.Component.Share.ShareModal::socialTabShown",{modal:c.attr("id")}))}c.find(".linkCodes").children().length===0&&$(document).trigger($.Event("Pb.Component.Share.ShareModal::linksTabShown",{modal:c.attr("id")}))},this));var v=c.find(".nav-tabs");if(s==="email"){v.find('a[data-tabtype="email"]').tab("show");Pb.Component.Share.SocialShare.setOptions(null)}else if(s==="followers")v.find('a[data-tabtype="followers"]').tab("show");else{v.find('a[data-tabtype="social"]').tab("show");v.find('a[data-tabtype="social"]').trigger($.Event("shown"));if(s==="facebook"||s==="twitter"){Pb.Component.Share.SocialShare.setOptions({service:s});Pb.Component.Share.SocialShare.updateUI()}else Pb.Component.Share.SocialShare.setOptions({showMore:!0})}c.find("#shareModal_email").find("#shareModalSubmit").on("click",$.proxy(function(e){e.preventDefault();if(!$(this).hasClass("disabled")){Pb.Data.data.shareModal.shareObject.hashtag&&Pb.Track.tr("share_modal_"+Pb.Data.data.shareModal.tabs.activeTab+"_hashtag_share_click");var t=c.find("form:visible");t.length&&this.onSubmit(e)}},this));c.find("#shareModal_social").find("#shareModalSubmit").on("click",$.proxy(function(e){e.preventDefault();if(!$(this).hasClass("disabled")){Pb.Data.data.shareModal.shareObject.hashtag&&Pb.Track.tr("share_modal_"+Pb.Data.data.shareModal.tabs.activeTab+"_hashtag_share_click");var t=c.find("form:visible");t.length&&this.onSubmit(e)}},this));l?c.find("#linksTitle").text(this.linkTitle):c.find("a#links").parent().css("display","none");if(r==="search"){$("#shareModal_links").hide();$("#shareModal_links").css("width","0px");$(".tabContainer").css("width","100%");$("#shareModal").css("width","586px")}if(Pb.Data.get("shareModal").isSponsoredEdit&&Pb.Data.get(Pb.Data.Shared.MEDIA).spedit){$("#shareModal").addClass(Pb.Data.get("shareModal").sponsoredClass);$("#socialmessage, #message").prop("placeholder",Pb.Data.get("shareModal").sponsoredShareMessage).val(Pb.Data.get("shareModal").sponsoredShareMessage)}},positionModal:function(){},onSuccess:function(t){e.superclass.onSuccess.call(this,t);$("textarea").val("");$("#toAddress, #fromAddress").val("");Pb.Data.get("shareModal").sponsor&&(Pb.Data.get(Pb.Data.Shared.ALBUM)?$("textarea").val(Pb.Data.get(Pb.Data.Shared.ALBUM).sponsoredShareMessage):$("textarea").val(Pb.Data.get("shareModal").sponsoredShareMessage))},buildSubmitData:function(){var e=null;if(this.currentController){this.submitUrl=this.currentController.getSubmitUrl();e=this.currentController.buildSubmitData(Pb.Data.get(this.modalName))}e&&Pb.Data.get("shareModal").sponsor&&(e.sponsor=Pb.Data.get("shareModal").sponsor);return e},onFail:function(){$(document).trigger({type:"Pb.Component.Share.ShareModal::error"})},enableSubmit:function(){$("a#shareModalSubmit").removeClass("disabled")},disableSubmit:function(){$("a#shareModalSubmit").addClass("disabled")},getTitle:function(e,t){var n,r;if(e==="album"||e==="slideshow")if(t.isSlideshow){n="Share this slideshow";this.linkTitle="Slideshow Links"}else if(t.dirName){n="Share the album: "+t.dirName;this.linkTitle="Album Links"}else{n="Share: "+t.ownername+"'s Library";this.linkTitle="Library Links"}else if(e==="story"){t.title?n="Share the story: "+t.title:n="Share the story: "+t.dirName;this.linkTitle="Story Links"}else if(e==="recent"){t.ownername&&(n="Share: "+t.ownername+"'s Recent Uploads");this.linkTitle="Recent Links"}else if(e==="recentUploads"){n="Share: Recent Uploads";this.linkTitle="Recent Links"}else if(e==="hashtag"){n="Share the hashtag: "+t.hashtag;linkTitle="Hashtag Links"}else if(e==="search"){n="Share these search results";this.linkTitle="Search Links"}else{r=t.mediaType;r==="image"&&(r="photo");n="Share the "+r;t.title&&(n+=": "+t.title);this.linkTitle=r.charAt(0).toUpperCase()+r.slice(1)+" Links"}return n}};Pb.subclass(e,Pb.Component.Element.Modal,n);t=new e;Pb.InitEventQueue.add(function(){t.init()});return t}();$.getObject("Pb.Component.Common.Social",!0).GooglePlus=function(){function e(e,t){e.indexOf("?")>=0?e+="&":e+="?";var n="plus_share";t&&(n=t+"_"+n);e+="src=pb&evt="+n;e=encodeURIComponent(e);window.open("https://plus.google.com/share?url="+e,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600")}return{open:e}}();$.getObject("Pb.Component.Common.Social",!0).Pinterest=function(){function e(e,t,n){var r=t+"_pinterest_share",i="http://www.pinterest.com/pin/create/button/?url=",s="",o={url:e,directUrl:n,trackingKey:r},u="menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600";Object.keys(o).forEach(function(e){o[e]=encodeURIComponent(o[e])});s+=o.url+"&media="+o.directUrl+"&src=pb&evt="+o.trackingKey;window.open(i+s,"",u)}return{open:e}}();$.getObject("Pb.Component.Common.Social",!0).Tumblr=function(){function e(e,t){var n=e.shareMode,e=e.shareObject?e.shareObject:e,r=t+"_tumblr_share",i="https://www.tumblr.com/share/",s="",o={trackingKey:r},u=e.description?e.description.text||e.description:"",a=e.title||e.name;windowParams="menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600";n==="media"||e.mediaType?i+="photo?source="+encodeURIComponent(e.fullsizeUrl)+"&caption="+encodeURIComponent(a)+"&clickthru="+encodeURIComponent(e.linkUrl):n==="story"?i+="video?embed="+encodeURIComponent(e.linkcodes[1].inputText)+"&caption="+encodeURIComponent(a)+"&clickthru="+encodeURIComponent(e.storyUrl):i+="link?url="+encodeURIComponent(e.url||e.URL)+"&name="+encodeURIComponent(a)+"&description="+encodeURIComponent(u);s+="&src=pb&evt="+o.trackingKey;window.open(i+s,"",windowParams)}return{open:e}}();$.getObject("Pb.Component.Share",!0).SocialShare=function(){function e(){this.init()}var t={options:null,facebookFeedUrl:"https://www.facebook.com/dialog/share",twitterFeedUrl:"http://twitter.com/intent/tweet",init:function(){this.initEvents()},initEvents:function(){$(document).on("Pb.Component.Share.ShareModal::shown",$.proxy(this.onModalShown,this));$(document).on("Pb.Component.Share.ShareModal::hidden",$.proxy(this.onModalHidden,this));$(document).on("Pb.Component.Share.ShareModal::socialTabShown",$.proxy(this.onTabShown,this))},onModalShown:function(e){var t=Pb.Data.get("shareModal"),n="input[name=defaultMessage_"+t.shareMode+"]",r=Pb.Data.get("shareModal"),i=r.embed?"#"+r.id+"Embed":"#"+r.id,s=$(i),o=s.find("#socialShare").find("form");s.find("#socialmessage").attr("placeholder",o.find(n).val());s.find("#socialShare_more_label").on("click",$.proxy(this.onLessOrMoreClick,this));s.find("#socialShare_less_label").on("click",$.proxy(this.onLessOrMoreClick,this));s.find(".extra-service-selector .pinterest").on("click",function(){t.shareMode==="search"?Pb.Component.Common.Social.Pinterest.open(Pb.Data.Shared.get("shared.searchSetCollection").data.url,"search",Pb.Data.Shared.get("shared.searchSetCollection").data.items[0].fullsizeUrl):t.shareMode==="recentUploads"?Pb.Component.Common.Social.Pinterest.open(t.shareObject.data.url,"recentUploads",t.shareObject.data.thumbUrl):t.shareMode==="album"?Pb.Component.Common.Social.Pinterest.open(t.shareObject.url,"share",t.shareObject.thumbUrl):Pb.Component.Common.Social.Pinterest.open(t.shareObject.linkUrl,"share",t.shareObject.fullsizeUrl)});s.find(".extra-service-selector .tumblr").on("click",function(e){var n=t.shareMode==="search"||t.shareMode==="recentUploads"?t.pbEventTarget:t;Pb.Component.Common.Social.Tumblr.open(n,"share")});s.find(".moreIconsButton").on("click",function(){s.find("#socialShare_more").show();s.find(".moreIconsButton").hide();s.find(".lessIconsButton").show()});s.find(".lessIconsButton").on("click",function(){s.find("#socialShare_more").hide();s.find(".lessIconsButton").hide();s.find(".moreIconsButton").show()});s.find("#socialShare div.connectionInfo").on("Pb_Component_ExternalSite_Connection::success Pb_Component_ExternalSite_Connection::selectCheckbox Pb_Component_ExternalSite_Connection::unselectCheckbox Pb_Component_ExternalSite_Connection::error",$.proxy(this.onServiceClick,this));s.find("#socialShare .service-selector li > input").on("change",$.proxy(this.onServiceClick,this));s.on("click","#facebookConnection .socialicon, #twitterConnection .socialicon",function(e){$(e.currentTarget).parent().parent().find("input").click()});this.fetchShareThis();this.reset();this.updateUI();this.updateMessage()},updateMessage:function(){var e=Pb.Data.get("shareModal");e.shareMode==="hashtag"&&($("#service_twitter").is(":checked")?$("#socialmessage").val("I got a @Photobucket Hashtag! Use "+e.shareObject.hashtag+" to share photos & videos with me! All our pics will be in this album: "):$("#service_facebook").is(":checked")?$("#socialmessage").val("I've got my own Photobucket Hashtag!  Add my hashtag "+e.shareObject.hashtag+" when you post pictures to Twitter, Instagram or Photobucket to share your photos with me!  All our pictures will be in this album on Photobucket: "):$("#socialmessage").val("I got a @Photobucket Hashtag! Use "+e.shareObject.hashtag+" to share photos & videos with me! All our pics will be in this album: "))},fetchShareThis:function(){typeof stLight=="undefined"?$.ajax({url:"http://w.sharethis.com/button/buttons.js",dataType:"script",success:$.proxy(function(){stLight.options({publisher:"6b3cc47e-c11d-420e-a208-11704eb2c43b"});this.updateShareThis()},this),cache:!0}):this.updateShareThis()},updateShareThis:function(){if(typeof stWidget!="undefined"){var e=Pb.Data.get("shareModal"),t=this.getExternalShareData(e.shareMode,e.shareObject);$(".extra-service-selector span:not(.native)").empty();$(".extra-service-selector span:not(.native)").each(function(e,n){var r={service:$(this).attr("class"),element:this,url:t.url,title:t.name,type:"large",image:t.picture};stWidget.addEntry(r)});$(".moreIconsButton").show()}},onModalHidden:function(){var e=Pb.Data.get("shareModal"),t=e.embed?"#"+e.id+"Embed":"#"+e.id,n=$(t);n.find("#socialShare_more_label").off("click");n.find("#socialShare_less_label").off("click");n.find(".service-selector li input").off("change");n.find(".service-selector").off(".socialShare");n.find("#socialmessage").val("")},onLessOrMoreClick:function(){$("#socialShare_more_label").is(":visible")?this.toggleMore(!0):this.toggleMore(!1)},onServiceClick:function(e){var t=Pb.Data.get("shareModal"),n=t.embed?"#"+t.id+"Embed":"#"+t.id,r=$(n);e.type==="Pb_Component_ExternalSite_Connection::success"||e.type==="Pb_Component_ExternalSite_Connection::selectCheckbox"?$(e.currentTarget.parentNode).addClass("selected"):e.type==="Pb_Component_ExternalSite_Connection::unselectCheckbox"||e.type==="Pb_Component_ExternalSite_Connection::error"?$(e.currentTarget.parentNode).removeClass("selected"):$(e.currentTarget.parentNode).toggleClass("selected");this.updateMessage()},onTabShown:function(e){e.stopImmediatePropagation();var t=Pb.Data.get("shareModal"),n,r,i,s,o=t.embed?"#"+t.id+"Embed":"#"+t.id,u=$(o);if(t&&t.socialShare&&t.socialShare.sites){n=t.socialShare.sites;for(r=0;r<n.length;r++){i={connectionData:n[r],element:o+" #"+n[r].service+"Connection",promptForAutoPublish:n[r].promptForAutoPublish};s=new Pb.Component.ExternalSite.Connection(i);Pb.Data.add("connection-"+n[r].service,s)}}if(!Pb.Data.get("isLoggedIn")){var a=u.find(".connectionInfo"),f=this.getExternalShareData(t.shareMode,t.shareObject);a.find('input[type="checkbox"]').each(function(){$(this).hide()});u.find(".service-selector").on("click",".facebook-icon, #lbl_facebook, .twitter-icon, #lbl_twitter",$.proxy(function(e){var t=$(e.currentTarget),n,r,i="";if(t.hasClass("facebook-icon")||t.attr("id")==="lbl_facebook"){n={app_id:Pb.Data.get("connection-facebook").connectionData.serviceAppId,href:f.url,redirect_uri:"http://"+document.location.hostname+"/externalpopup",display:"popup"};i=$.param(n);i=i.replace(/\+/g,"%20");r=this.facebookFeedUrl+"?"+i;window.open(r,"Share","width=550,height=420")}else if(t.hasClass("twitter-icon")||t.attr("id")==="lbl_twitter"){r=this.twitterFeedUrl+"?url="+encodeURIComponent(f.url.replace(" ","%20"));f.pbTitle!==""&&(r+="&text="+escape(f.pbTitle));window.open(r,"Share","width=550,height=420")}},this));Pb.Component.Share.ShareModal.disableSubmit()}else Pb.Component.Share.ShareModal.enableSubmit()},getSubmitUrl:function(){return $("#socialShare").find("form").attr("action")},buildSubmitData:function(e){var t=Pb.Data.get("shareModal"),n=$("#socialShare:visible").first().find("form"),r=n.find(".service-selector").find("input:checked:not(:disabled)"),i=null,s=r.map(function(){return this.id}).get().join(","),o=e.shareMode==="slideshow"?e.shareObject.slideshowUrl:e.shareObject.fullsizeUrl||e.shareObject.url||e.shareObject.data.url,t={targetType:e.shareMode,services:s,message:n.find("#socialShare_message textarea").val()};e.shareMode==="search"?i=Pb.Data.get(Pb.Data.Shared.SEARCH_SET)[0].thumbUrl:e.shareMode==="recentUploads"?i=e.shareObject.data.thumbUrl:e.shareMode==="story"&&(i=Pb.Data.get("storyPage").thumbUrl);i&&(t.targetThumbUrl=i);t.target=o;return t},reset:function(){this.toggleMore(!0)},setOptions:function(e){this.options=e},toggleMore:function(e){var t=Pb.Data.get("shareModal"),n=t.embed?"#"+t.id+"Embed":"#"+t.id,r=$(n);if(e){r.find("#socialShare_more_label").hide();r.find("#socialShare_less_label").show();r.find("#socialShare_more_content").show()}else{r.find("#socialShare_more_label").show();r.find("#socialShare_less_label").hide();r.find("#socialShare_more_content").hide()}},updateUI:function(){if(this.options){this.options.showMore&&this.toggleMore(!0);if(this.options.service){var e=Pb.Data.get("shareModal"),t=e.embed?"#"+e.id+"Embed":"#"+e.id,n=$(t),r=n.find("#service_"+this.options.service);r.trigger("Pb_Component_ExternalSite_Connection::checkboxChange");n.find("#service_facebook, #service_twitter").removeAttr("checked");n.find("#service_"+this.options.service).prop("checked","checked")}}},getExternalShareData:function(e,t){var n={url:"",caption:"photobucket.com",description:"",name:"",picture:"",pbTitle:""};if(e==="album"||e==="slideshow"){n.url=e==="slideshow"?t.slideshowUrl:t.url;t.thumbFileName?n.picture="http://"+t.subdomain+".photobucket.com"+t.path+"/bth_"+t.thumbFileName:t.media&&t.media.length>0?n.picture=t.media[0].thumbUrl:t.items&&t.items.length>0&&(n.picture=t.items[0].thumbUrl);n.name=t.ownername+"'s ";n.name+=t.isRootAlbum?"library":t.name+" "+e;n.name+=" on Photobucket";n.description=t.description?t.description.text:""}else if(e==="recent"){n.url=t.data.url;n.name="Recent Uploads on Photobucket"}else if(e==="recentUploads"){n.url=t.data.url;n.name="Recent Uploads on Photobucket";n.picture=t.data.thumbUrl}else if(e==="story"){n.url=t.storyUrl;t.thumbUrl?n.picture=t.thumbUrl:t.media&&t.media.length>0?n.picture=t.media[0].thumbUrl:t.items&&t.items.length>0&&(n.picture=t.items[0].thumbUrl);n.name=t.ownername+"'s ";n.name+=t.isRootAlbum?"story":t.name+" "+e;n.name+=" on Photobucket";n.description=t.description?t.description.text:"";n.pbTitle=n.name}else if(e==="search"){n.url=t.data.url;n.name=t.data.title;n.picture=t.data.items[0].thumbUrl;n.pbTitle=n.name;n.description=t.data.description?t.data.description:""}else if(e==="hashtag"){n.url=t.url;n.name=t.hashtag}else{n.url=t.linkUrl;n.picture=t.fullsizeUrl;if(t.title!==""){n.name=t.title;n.pbTitle=n.name}else{n.name=t.username+"'s ";n.name+=t.mediaType==="image"?" photo":t.mediaType;n.name+=" on Photobucket"}n.description=t.description?t.description.text:""}n.url+=n.url.indexOf("?")===-1?"?src=pb_unauth":"&src=pb_unauth";return n}};$.extend(e.prototype,t);return new e}();$.getObject("Pb.Component.ExternalSite",!0).Connection=function(){function e(e){this.init(e)}var t={init:function(e){this.element=$(e.element);this.connectionData=e.connectionData;e.hasOwnProperty("promptForAutoPublish")?this.promptForAutoPublish=e.promptForAutoPublish:this.promptForAutoPublish=!0;this.linkData();this.initEvents()},initEvents:function(){if(Pb.Data.get("isLoggedIn")){this.connectionData.connectMethod==="checkbox"?this.element.find("input[type=checkbox]").on("click Pb_Component_ExternalSite_Connection::checkboxChange",$.proxy(this.connectByCheckbox,this)):this.element.on("click",".connectLink",$.proxy(function(e){e.preventDefault();var t=$(e.currentTarget);this.toggleConnection(t)},this));this.element.on("change",".autoShare input",$.proxy(function(e){this.toggleAutoshare(e.currentTarget.checked)},this))}},toggleConnection:function(e){var t=e.attr("href"),n=e.data("connected"),r=$(e).data("track");if(n)this.disconnect();else{if($(e).hasClass("mobile")&&r){Pb.Track.tr(r);location.href=t;return}this.doConnect(t)}},connect:function(e){this.doConnect(e.href)},doConnect:function(e){$(document).one("Pb.Component.ExternalSite.Connect::connect",$.proxy(this.connectCallback,this));Pb.Component.ExternalSite.Connect.connect(e,!this.promptForAutoPublish)},connectByCheckbox:function(e){e.type==="Pb_Component_ExternalSite_Connection::checkboxChange"&&(e.target.checked=!e.target.checked);if(e.target.checked)if(this.connectionData.isConnected&&this.connectionData.service!=="facebook"||this.connectionData.isConnected&&this.connectionData.service=="facebook"&&this.connectionData.hasPublishActions)this.element.trigger("Pb_Component_ExternalSite_Connection::selectCheckbox");else{this.doConnect($(e.target).data("connecturl"));e.target.disabled=!0}else this.element.trigger("Pb_Component_ExternalSite_Connection::unselectCheckbox")},connectCallback:function(e){var t,n,r;if(e.status){n=e.connectInfo.siteAuth;this.connectionData.isConnected=!0;this.connectionData.hasPublishActions=!1;this.connectionData.siteUsername=n.siteUsername;this.connectionData.siteUserLink=n.siteUserLink;this.connectionData.siteUserImage=n.siteUserImage;this.connectionData.style==="verbose"?this.connectionData.connectionLabel="Connected as "+n.siteUsername:this.connectionData.connectionLabel=n.siteUsername;if(this.connectionData.actionBtn){var i=this.connectionData.actionBtn;i.classString=i.classString.replace(/btn-primary/,"btn-secondary");i.label="Disconnect";i.iconClass="icon-minus-sign";i.extraAttributes="data-connected='true'"}this.connectionData.autoshare&&(n.publishState&&n.publishState.toLowerCase()==="auto"?this.connectionData.autoshare.boxes[0].value="true":this.connectionData.autoshare.boxes[0].value="false");this.linkData();this.element.trigger({type:"Pb_Component_ExternalSite_Connection::success",siteAuth:n});t=this.element.find("input[type=checkbox]");if(t.length){t.prop("disabled",!1);t.prop("checked",!0)}}else{r={type:"Pb_Component_ExternalSite_Connection::error"};t=this.element.find("input[type=checkbox]");if(t.length){t.prop("disabled",!1);t.prop("checked",!1)}this.element.trigger(r)}},linkData:function(){var e;Pb.JSTemplates.link("#connectionItem",this.element,this.connectionData);this.connectionData.autoshare&&this.element.find(".autoShare input").prop("checked",this.connectionData.autoshare.boxes[0].value==="true")},disconnectSuccess:function(e){if(e.status){this.connectionData.isConnected=!1;if(this.connectionData.actionBtn){var t=this.connectionData.actionBtn;t.classString=t.classString.replace(/btn-secondary/,"btn-primary");t.label="Connect";t.iconClass="";t.extraAttributes="data-connected='false'"}this.connectionData.autoshare&&(this.connectionData.autoshare.boxes[0].value="false");this.linkData()}},disconnect:function(){Pb.Component.ExternalSite.DisconnectConfirm&&Pb.Component.ExternalSite.DisconnectConfirm.show(this.connectionData.siteId,$.proxy(this.disconnectSuccess,this))},handleAutoshareSuccess:function(e){var t=this.element.find(".autoShare input");this.connectionData.autoshare.boxes[0].value=t.prop("checked")?"true":"false"},handleAutoshareError:function(e){var t;if(e.data&&e.data.requiredPermissions){t=this.element.find(".actionButton");if(t.length){$(document).one("Pb.Component.ExternalSite.Connect::permissions",$.proxy(function(e){e.status===1?this.toggleAutoshare(!0):this.resetAutoshare()},this));Pb.Component.ExternalSite.Connect.getPermissions(t.attr("href"),e.data.requiredPermissions)}}else this.resetAutoshare()},resetAutoshare:function(){var e=this.element.find(".autoShare input");e.prop("checked",!e.prop("checked"));this.connectionData.autoshare.boxes[0].value=e.prop("checked")?"true":"false"},toggleAutoshare:function(e){Pb.Ajax.ajax({url:"/action/externalSite/updateAutoShare",data:{siteId:this.connectionData.siteId,autoshare:e},success:$.proxy(function(e){e.status?this.handleAutoshareSuccess(e):this.handleAutoshareError(e)},this),error:$.proxy(this.handleAutoshareError,this)})}};e.prototype=t;return e}();$.getObject("Pb.Component.ExternalSite",!0).DisconnectConfirm=function(){function e(){e.superclass.constructor.call(this)}if(!Pb.Modal||!Pb.Modal.ModalActionBase)return null;var t,n={init:function(t){var n={modalId:"#disconnectConfirm",modalName:"disconnectConfirm",submitButtonId:"#disconnectSubmit",submitUrl:"/action/externalSite/disconnect",showProgress:!0};t&&$.extend(n,t);e.superclass.init.call(this,n)},show:function(e,t,n){$(this.modalId).find("#siteId").val(e);t&&(this.onSuccess=this.getSuccessCallback(t));n&&(this.onFail=n);this.onShow()},buildSubmitData:function(){var e=$(this.modalId).find("form"),t={siteId:e.find("#siteId").val()};return t},getSuccessCallback:function(e){return function(t){Pb.Component.Common.ProfilePic.ProfilePic.update(t.data.profilePic);$(document).trigger({type:"DisconnectConfirm::success",siteId:t.data.siteId});e.call(this,t)}}};Pb.subclass(e,Pb.Modal.ModalActionBase,n);t=new e;Pb.InitEventQueue.add(function(){t.init()});return t}();$.getObject("Pb.Component.Share",!0).Email=function(){function e(){this.init()}var t={init:function(){this.initEvents();this.hasCaptcha=!1;this.captchaSolved=!1;this.validator=new Pb.InputValidator;this.isLoggedIn=Pb.Data.get("isLoggedIn")},initEvents:function(){$(document).on("Pb.Component.Share.ShareModal::shown",$.proxy(this.onModalShown,this));$(document).on("Pb.Component.Share.ShareModal::hidden",$.proxy(this.onModalHidden,this));$(document).on("Pb.Component.Share.ShareModal::emailTabShown",$.proxy(this.onTabShown,this));$(document).on("keyup blur change mouseout input","input#toAddress, input#fromAddress",$.proxy(this.checkEmailFields,this))},onCaptchaSuccess:function(){this.captchaSolved=!0;this.checkEmailFields()},onModalShown:function(e){this.captchaSolved=!1;var t=Pb.Data,n=t.get("shareModal"),r=n.embed?"#"+n.id+"Embed":"#"+n.id,i=$(r),s=i.find(".shareEmail").find("form"),o=t.get("isLoggedIn");s.length>0&&s.get(0).reset();var u="input[name=defaultMessage_"+n.shareMode+"]";s.find("#message").attr("placeholder",s.find(u).val());this.attachCaptcha();n.shareMode==="hashtag"&&$("#message").val("I've got my own Photobucket Hashtag!  Add my hashtag "+n.shareObject.hashtag+" when you post pictures to Twitter, Instagram or Photobucket to share your photos with me!  All our pictures will be in this album on Photobucket: "+n.shareObject.url);$(document).on("Pb.Component.Share.ShareModal::error",$.proxy(this.onFail,this))},attachCaptcha:function(){var e=new Pb.Component.Element.Captcha.Checkbox;e.renderCaptcha("form#shareEmail");$(e.id).on("Pb.Component.Element.Captcha.Checkbox::challenge_solved",$.proxy(this.onCaptchaSuccess,this));this.hasCaptcha=!0},checkEmailFields:function(){var e=!1,t=!1,n=!1,r=$("input#fromAddress").val(),i=$("input#toAddress").val();if(i){var s=i.split(","),o=s.length;if(o>1)for(var u=0;u<o;u+=1){if(!this.validator.validEmail(s[u].trim())){n=!1;break}n=!0}else n=this.validator.validEmail(i)}r&&(t=this.validator.validEmail(r));e=this.isLoggedIn?n&&this.captchaSolved:n&&t&&this.captchaSolved;e?Pb.Component.Share.ShareModal.enableSubmit():Pb.Component.Share.ShareModal.disableSubmit()},onModalHidden:function(){$(document).off("Pb.Component.Share.ShareModal::error",$.proxy(this.onFail,this))},onTabShown:function(e){e.stopImmediatePropagation();Pb.Component.Share.ShareModal.disableSubmit();var t=$("#"+e.modal);t.find("#shareModalSubmit").show()},getSubmitUrl:function(){return $(".shareEmail").first().find("form").attr("action")},buildSubmitData:function(e){var t=Pb.Data.get("shareModal"),n=$(".shareEmail:visible").first().find("form"),r,i=e.shareObject.fullsizeUrl,s=null,t={targetType:e.shareMode};r=n.find("input");for(var o=0;o<r.length;o++)t[r[o].name]=r[o].value;r=n.find("textarea");for(var o=0;o<r.length;o++)t[r[o].name]=r[o].value;if(!i){i=e.shareObject.url;e.shareMode==="slideshow"&&(i=e.shareObject.slideshowUrl);if(e.shareMode==="search"){i=e.shareObject.data.url;s=Pb.Data.get(Pb.Data.Shared.SEARCH_SET)[0].thumbUrl}else if(e.shareMode==="recentUploads"){i=e.shareObject.data.url;s=e.shareObject.data.thumbUrl}else e.shareMode==="story"&&(s=Pb.Data.get("storyPage").thumbUrl)}t.target=i;s&&(t.targetThumbUrl=s);return t},setOptions:function(e){this.options=e},resetErrors:function(){$(".control-group").removeClass("error");$(".help-inline").text("")},onFail:function(){Pb.Component.Share.ShareModal.disableSubmit()}};$.extend(e.prototype,t);return new e}();$.getObject("Pb.Component.Element.Captcha",!0).Checkbox=function(){function e(e){this.init(e)}var t={init:function(e){this.scriptTag="<script>var runCallback="+this.pbCaptchaCallback.toString()+";</script>";this.captchaSrc='<script src="https://www.google.com/recaptcha/api.js?onload=runCallback&render=explicit" async defer></script>';this.id="#checkboxCaptcha";this.instructions="Please check the box so we know you're human.";this.errorCopy="You must check the box to prove you're human."},pbCaptchaCallback:function(){grecaptcha.render("recaptcha_widget",{sitekey:"6Ld39wYAAAAAAHRh1EnuW-QHMbOsPSRCNg4jgvqe",type:"image",callback:function(e){$("#checkboxCaptcha").trigger($.Event("Pb.Component.Element.Captcha.Checkbox::challenge_solved",{responseData:e}));$("#recaptcha_widget").removeClass("error")}})},renderCaptcha:function(e){var t=$(Pb.JSTemplates.render("#checkboxCaptchaTemplate",{errorCopy:this.errorCopy,instructions:this.instructions,scriptTag:this.scriptTag,captchaSrc:this.captchaSrc}));$(e).append(t)}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Element.Form",!0).Honeypot=function(){function e(e){}return{init:e}}();(function(){function e(e){e.stopImmediatePropagation();new Pb.Component.Common.Links.LinkCodes({selector:"#"+e.modal+" .linkCodes",prefix:e.modal});$("#"+e.modal+" .linkCodes").trigger({type:"Pb.Component.Common.Links.LinkCodes::refresh",objectData:Pb.Data.get("shareModal").shareObject})}$(document).on("Pb.Component.Share.ShareModal::linksTabShown",e)})();(function(){var e=typeof window!="undefined"?window:exports,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n=function(){try{document.createElement("$")}catch(e){return e}}();e.btoa||(e.btoa=function(e){for(var r,i,s=0,o=t,u="";e.charAt(s|0)||(o="=",s%1);u+=o.charAt(63&r>>8-s%1*8)){i=e.charCodeAt(s+=.75);if(i>255)throw n;r=r<<8|i}return u});e.atob||(e.atob=function(e){e=e.replace(/=+$/,"");if(e.length%4==1)throw n;for(var r=0,i,s,o=0,u="";s=e.charAt(o++);~s&&(i=r%4?i*64+s:s,r++%4)?u+=String.fromCharCode(255&i>>(-2*r&6)):0)s=t.indexOf(s);return u})})();$.getObject("Pb.Media",!0).MediaIdentifierFactory=function(){function e(){}var t={getIdentifier:function(e){var t;e instanceof Pb.Path.PBPath?t=this.fromPBPath(e):e.path?t=this.fromPBPath(new Pb.Path.PBPath(e.path)):t=null;return t},fromPBPath:function(e){var t=null;if(e.filename!==null){var n="path:";e.location===""||e.location===null?n+="/"+e.filename:n+=e.location+e.filename;t=btoa(n)}return t}};$.extend(e.prototype,t);return new e}();$.getObject("Pb.Path",!0).PBPath=function(){function e(e){this.pathString=decodeURIComponent(e);this.parse(this.pathString)}var t={pathFormat:/^\/?([^\/]+)\/([^\/]+)\/([^\/]+)\/(.*\/)?([^\/]+)$/,parse:function(e){var t=this.pathFormat.exec(e);if(t==null){this.albumType=null;this.vee=null;this.ownername=null;this.location=null;this.filename=null}else{this.albumType=t[1];this.vee=t[2];this.ownername=t[3];this.location=t[4]===undefined?"":t[4];this.filename=t[5]}}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Common.Links",!0).LinkCodes=function(){function e(e){this.init(e)}function t(e,t){switch(e){case"email":return"Email & IM";case"direct":return"Direct";case"html":return t==="verbose"?"HTML <span>(for eBay, Craigslist, blogs, websites)</span>":"HTML";case"htmlThumb":return"HTML thumb";case"img":return t==="verbose"?"IMG codes <span>(for forums, boards)</span>":"IMG";case"imgThumb":return"IMG thumb";case"slideshow":return"Slideshow";case"story":return"Story";case"embed":return"Embed";default:return""}}function n(e,n,r,i,s,o){var u=t(e,o),a=null;u&&(a={zclipId:i+"_zeroclipboard_"+r,cclipboardId:i+"_copycode_"+r,ccInputId:i+"_ccinput_"+r,inputLabel:u,inputText:$("<div />").html(n).text(),tracking:"share_file_get_link_code_"+e+"_click",type:s});return a}var r={init:function(e){if(!e.selector)return;this.element=$(e.selector);this.prefix=e.prefix;this.labelType=e.labelType;this.inputType=e.inputType;this.inputType||(this.inputType="input");this.linkCodesData=[];this.initEvents();$(document).on("Pb.Component.Album.Edit.EditAlbum::editAlbumCompleted",$.proxy(function(e){e.album?e.objectData=e.album.data:e.objectData=Pb.Data.Albums.getCurrentAlbumData()[0];this.refresh(e)},this));this.element.length&&Pb.JSTemplates.link("#copyCodeTemplate",this.element,this.linkCodesData)},initEvents:function(){this.element.on("Pb.Component.Common.Links.LinkCodes::refresh",$.proxy(this.refresh,this))},populateCodes:function(e,t){var n=[],r=0,i=!1;t&&t.privacyLevel&&t.privacyLevel==="private"&&(i=!0);if(i){$(".linkCodes, .link-container, #socialShare, #emailShare").addClass("privateLinks");$("#shareModalSubmit").addClass("disabled")}else{$(".linkCodes, .link-container, #socialShare, #emailShare").removeClass("privateLinks");$("#shareModalSubmit").removeClass("disabled")}if($.isArray(e)){for(r=0;r<e.length;r++){e[r].zclipId=this.prefix+"_zeroclipboard_"+r;e[r].cclipboardId=this.prefix+"_copycode_"+r;e[r].ccInputId=this.prefix+"_ccinput_"+r}$.observable(this.linkCodesData).refresh(e);this.bindCopyCodes()}else if(!$.isEmptyObject(e)){n=this.buildLinkCodesFromArray(e);$.observable(this.linkCodesData).refresh(n);this.bindCopyCodes()}else this.element.html('<p class="noLinkCodes">No link options enabled</p>')},buildLinkCodesFromArray:function(e){var t,r=0,i,s=[];for(t in e)if(e.hasOwnProperty(t)){i=n(t,e[t],r,this.prefix,this.inputType,this.labelType);if(i){s.push(i);r++}}return s},refresh:function(e){var t,n,r,i,s,o;if(e.objectData&&e.objectData.linkcodes){t=e.objectData.linkcodes;if(typeof t=="string"){t=$.parseJSON(t);e.objectData.linkcodes=t}this.populateCodes(t,e.objectData)}else if(e.objectData!==undefined)if(e.objectData.type==="Pb_Component_Media_MediaThumbnail"||e.objectData.type==="Pb_Component_Library_MediaSelector_MediaThumbnail"){if(e.objectData.linkCodesConfig){o=e.objectData.linkCodesConfig;t=[];for(s=0;s<o.length;s++)t[o[s]]="Loading...";$.observable(this.linkCodesData).refresh(this.buildLinkCodesFromArray(t))}else $.observable(this.linkCodesData).refresh([]);n=new Pb.Path.PBPath(e.objectData.path);r=Pb.Media.MediaIdentifierFactory.getIdentifier(n);i={type:"GET",url:"/api/user/"+n.ownername+"/media/"+encodeURIComponent(r)+"/links",error:$.proxy(this.onRetrieveLinksError,this),success:$.proxy(function(t){this.onRetrieveLinksSuccess(t,e.objectData)},this)};Pb.Ajax.ajax(i)}else if(e.objectData.type==="album"){var u;if(e.objectData.linkCodesConfig){o=e.objectData.linkCodesConfig;t=[];for(s=0;s<o.length;s++)t[o[s]]="Loading...";$.observable(this.linkCodesData).refresh(this.buildLinkCodesFromArray(t))}else $.observable(this.linkCodesData).refresh([]);u=e.objectData.path.split("/");if(u.length<3)return;var a=u[2];n=u.slice(3).join("/");i={type:"GET",url:"/api/user/"+a+"/album/"+n+"/links",error:$.proxy(this.onRetrieveLinksError,this),success:$.proxy(function(t){this.onRetrieveLinksSuccess(t,e.objectData)},this)};Pb.Ajax.ajax(i)}else if(e.objectData.type==="recent"){var t=this.buildLinkCodesFromArray({email:Pb.Data.Albums.getRootAlbum().url});e.objectData.linkcodes=t;this.populateCodes(t,e.objectData)}else if(e.objectData.data.type==="recent"){var t=this.buildLinkCodesFromArray({email:e.objectData.data.url});e.objectData.linkcodes=t;this.populateCodes(t,e.objectData)}},bindCopyCodes:function(){var e=Pb.Component.Common.CopyCode.CopyCode,t=0;for(t=0;t<this.linkCodesData.length;t++)e.createZeroClipboard("#"+this.linkCodesData[t].ccInputId,!1)},onRetrieveLinksError:function(e,t,n){typeof console!="undefined"&&console.error(n)},onRetrieveLinksSuccess:function(e,t){t.linkcodes=e.data;this.populateCodes(e.data,t)}};$.extend(e.prototype,r);$.views.helpers({buildLinkCodeData:n,getLinkCodeLabel:t,unescapeLinkCode:function(e){return $("<div />").html(e).text()}});return e}();$.getObject("Pb.Component.Share",!0).Warning=function(){function e(e){this.init(e)}var t={warningData:[],init:function(e){this.initEvent();$(document).on("Pb.Component.Album.Edit.EditAlbum::editAlbumCompleted",$.proxy(this.hideWarning,this))},initEvent:function(){$(document).one("change","#makePublic",$.proxy(this.makePublic,this))},hideWarning:function(e){var t,n;e.album?t=e.album.data:t=Pb.Data.Albums?Pb.Data.Albums.getCurrentAlbumData()[0]:Pb.Data.Shared.get("shared.album");n=Pb.Data.Albums?Pb.Data.Albums.getCurrentAlbumData()[0].name:Pb.Data.Shared.get("shared.album").name;t.privacyPassword&&t.privacyPassword!==null&&t.privacyLevel!=="password";if(t.name===n)if(t.privacyLevel==="private"){$(".privateWarningMessage").show();$(".privacyIcon").find("i").removeClass().addClass("icon-lock")}else{$(".privateWarningMessage").hide();t.privacyLevel==="public"&&$(".privacyIcon").find("i").removeClass().addClass("icon-unlock");t.privacyLevel==="password"&&$(".privacyIcon").find("i").removeClass().addClass("icon-key")}},makePublic:function(e){e.preventDefault();e.stopImmediatePropagation();$(e.currentTarget).prop("checked",!0);Pb.Ajax.ajax({url:"/action/album/update",data:{privacyLevel:"public",name:$(e.currentTarget).data("name"),albumPath:$(e.currentTarget).data("path")},success:$.proxy(function(t){if(t.status){var n=Pb.Data.Albums?Pb.Data.Albums.getCurrentAlbumData()[0]:Pb.Data.Shared.get("shared.album");$.extend(n,t.data);$(document).trigger($.Event("Pb.Component.Album.Edit.EditAlbum::editAlbumCompleted",{album:{data:n}}))}else $(e.currentTarget).prop("checked",!1)},this),error:function(){$(e.currentTarget).prop("checked",!1)},complete:$.proxy(function(){this.initEvent()},this)})}};$.extend(e.prototype,t);return new e}();(function(e){e.fn.drag=function(t,n,r){var i=typeof t=="string"?t:"",s=e.isFunction(t)?t:e.isFunction(n)?n:null;i.indexOf("drag")!==0&&(i="drag"+i);r=(t==s?n:r)||{};return s?this.bind(i,r,s):this.trigger(i)};var t=e.event,n=t.special,r=n.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(t){var n=e.data(this,r.datakey),i=t.data||{};n.related+=1;e.each(r.defaults,function(e,t){i[e]!==undefined&&(n[e]=i[e])})},remove:function(){e.data(this,r.datakey).related-=1},setup:function(){if(e.data(this,r.datakey))return;var n=e.extend({related:0},r.defaults);e.data(this,r.datakey,n);t.add(this,"touchstart mousedown",r.init,n);this.attachEvent&&this.attachEvent("ondragstart",r.dontstart)},teardown:function(){var n=e.data(this,r.datakey)||{};if(n.related)return;e.removeData(this,r.datakey);t.remove(this,"touchstart mousedown",r.init);r.textselect(!0);this.detachEvent&&this.detachEvent("ondragstart",r.dontstart)},init:function(i){if(r.touched)return;var s=i.data,o;if(i.which!=0&&s.which>0&&i.which!=s.which)return;if(e(i.target).is(s.not))return;if(s.handle&&!e(i.target).closest(s.handle,i.currentTarget).length)return;r.touched=i.type=="touchstart"?this:null;s.propagates=1;s.mousedown=this;s.interactions=[r.interaction(this,s)];s.target=i.target;s.pageX=i.pageX;s.pageY=i.pageY;s.dragging=null;o=r.hijack(i,"draginit",s);if(!s.propagates)return;o=r.flatten(o);if(o&&o.length){s.interactions=[];e.each(o,function(){s.interactions.push(r.interaction(this,s))})}s.propagates=s.interactions.length;s.drop!==!1&&n.drop&&n.drop.handler(i,s);r.textselect(!1);r.touched?t.add(r.touched,"touchmove touchend",r.handler,s):t.add(document,"mousemove mouseup",r.handler,s);if(!r.touched||s.live)return!1},interaction:function(t,n){var i=e(t)[n.relative?"position":"offset"]()||{top:0,left:0};return{drag:t,callback:new r.callback,droppable:[],offset:i}},handler:function(i){var s=i.data;switch(i.type){case!s.dragging&&"touchmove":i.preventDefault();case!s.dragging&&"mousemove":if(Math.pow(i.pageX-s.pageX,2)+Math.pow(i.pageY-s.pageY,2)<Math.pow(s.distance,2))break;i.target=s.target;r.hijack(i,"dragstart",s);s.propagates&&(s.dragging=!0);case"touchmove":i.preventDefault();case"mousemove":if(s.dragging){r.hijack(i,"drag",s);if(s.propagates){s.drop!==!1&&n.drop&&n.drop.handler(i,s);break}i.type="mouseup"};case"touchend":case"mouseup":default:r.touched?t.remove(r.touched,"touchmove touchend",r.handler):t.remove(document,"mousemove mouseup",r.handler);if(s.dragging){s.drop!==!1&&n.drop&&n.drop.handler(i,s);r.hijack(i,"dragend",s)}r.textselect(!0);s.click===!1&&s.dragging&&e.data(s.mousedown,"suppress.click",(new Date).getTime()+5);s.dragging=r.touched=!1}},hijack:function(n,i,s,o,u){if(!s)return;var a={event:n.originalEvent,type:n.type},f=i.indexOf("drop")?"drag":"drop",l,c=o||0,h,p,d,v=isNaN(o)?s.interactions.length:o;n.type=i;n.originalEvent=null;s.results=[];do if(h=s.interactions[c]){if(i!=="dragend"&&h.cancelled)continue;d=r.properties(n,s,h);h.results=[];e(u||h[f]||s.droppable).each(function(o,u){d.target=u;n.isPropagationStopped=function(){return!1};l=u?t.dispatch.call(u,n,d):null;if(l===!1){if(f=="drag"){h.cancelled=!0;s.propagates-=1}i=="drop"&&(h[f][o]=null)}else i=="dropinit"&&h.droppable.push(r.element(l)||u);i=="dragstart"&&(h.proxy=e(r.element(l)||h.drag)[0]);h.results.push(l);delete n.result;if(i!=="dropinit")return l});s.results[c]=r.flatten(h.results);i=="dropinit"&&(h.droppable=r.flatten(h.droppable));i=="dragstart"&&!h.cancelled&&d.update()}while(++c<v);n.type=a.type;n.originalEvent=a.event;return r.flatten(s.results)},properties:function(e,t,n){var i=n.callback;i.drag=n.drag;i.proxy=n.proxy||n.drag;i.startX=t.pageX;i.startY=t.pageY;i.deltaX=e.pageX-t.pageX;i.deltaY=e.pageY-t.pageY;i.originalX=n.offset.left;i.originalY=n.offset.top;i.offsetX=i.originalX+i.deltaX;i.offsetY=i.originalY+i.deltaY;i.drop=r.flatten((n.drop||[]).slice());i.available=r.flatten((n.droppable||[]).slice());return i},element:function(e){if(e&&(e.jquery||e.nodeType==1))return e},flatten:function(t){return e.map(t,function(t){return t&&t.jquery?e.makeArray(t):t&&t.length?r.flatten(t):t})},textselect:function(t){e(document)[t?"unbind":"bind"]("selectstart",r.dontstart).css("MozUserSelect",t?"":"none");document.unselectable=t?"off":"on"},dontstart:function(){return!1},callback:function(){}};r.callback.prototype={update:function(){n.drop&&this.available.length&&e.each(this.available,function(e){n.drop.locate(this,e)})}};var i=t.dispatch;t.dispatch=function(t){if(t&&"type"in t&&e.data(this,"suppress."+t.type)-(new Date).getTime()>0){e.removeData(this,"suppress."+t.type);return}return i.apply(this,arguments)};var s=t.fixHooks.touchstart=t.fixHooks.touchmove=t.fixHooks.touchend=t.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(t,n){if(n){var r=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0]||null;r&&e.each(s.props,function(e,n){t[n]=r[n]})}return t}};n.draginit=n.dragstart=n.dragend=r})(jQuery);$.getObject("Pb.Component.Element.Toggle",!0).Toggle=function(){function e(e){this.init(e)}var t={container:null,dragging:!1,init:function(e){if(!e.container)return;this.container=$(e.container);this.bindEvents()},bindEvents:function(){var e=$(this.container).find(".ball"),t=$(this.container).find(".toggle");if(e.length&&t.length){this.initialOffset=e.offset().left;this.parentOffset=this.container.offset().left;e.drag("start",$.proxy(function(t,n){this.mouseOffset=t.pageX-e.offset().left;n.limit={};n.limit.left=3;n.limit.right=35;e.addClass("dragging")},this)).drag($.proxy(function(t,n){var r=t.pageX-this.parentOffset-this.mouseOffset,i=r;i<n.limit.left?i=n.limit.left:i>n.limit.right&&(i=n.limit.right);e.css({left:i})},this)).drag("end",$.proxy(function(n,r){this.preventClick=!0;n.stopPropagation();e.removeClass("dragging");var i=n.pageX-this.parentOffset,s=t.hasClass("on");i>r.limit.left+12&&!s||i<r.limit.right-12&&s?this.toggle():s?e.css("left",r.limit.right):e.css("left",r.limit.left)},this));t.on("click",$.proxy(function(){this.preventClick?this.preventClick=!1:this.toggle()},this))}},toggle:function(){var e=$(this.container).find(".ball"),t=$(this.container).find(".ballOn"),n=$(this.container).find(".ballOff"),r=$(this.container).find(".toggle");if(!r.hasClass("on")){r.addClass("on");e.css("left","35px");t.css("display","block");n.hide();this.container.trigger("Pb.Component.Element.Toggle.Toggle::on")}else{r.removeClass("on");e.css("left","3px");t.hide();n.css("display","block");this.container.trigger("Pb.Component.Element.Toggle.Toggle::off")}}};$.extend(e.prototype,t);return e}();(function(){"use strict";var e=function(e,t){var n=e.style[t];e.currentStyle?n=e.currentStyle[t]:window.getComputedStyle&&(n=document.defaultView.getComputedStyle(e,null).getPropertyValue(t));if(n=="auto"&&t=="cursor"){var r=["a"];for(var i=0;i<r.length;i++)if(e.tagName.toLowerCase()==r[i])return"pointer"}return n},t=function(e){if(!c.prototype._singleton)return;e||(e=window.event);var t;this!==window?t=this:e.target?t=e.target:e.srcElement&&(t=e.srcElement);c.prototype._singleton.setCurrent(t)},n=function(e,t,n){e&&(e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n))},r=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)},i=function(e,t){if(e.addClass){e.addClass(t);return e}if(t&&typeof t=="string"){var n=(t||"").split(/\s+/);if(e.nodeType===1)if(!e.className)e.className=t;else{var r=" "+e.className+" ",i=e.className;for(var s=0,o=n.length;s<o;s++)r.indexOf(" "+n[s]+" ")<0&&(i+=" "+n[s]);e.className=i.replace(/^\s+|\s+$/g,"")}}return e},s=function(e,t){if(e.removeClass){e.removeClass(t);return e}if(t&&typeof t=="string"||t===undefined){var n=(t||"").split(/\s+/);if(e.nodeType===1&&e.className)if(t){var r=(" "+e.className+" ").replace(/[\n\t]/g," ");for(var i=0,s=n.length;i<s;i++)r=r.replace(" "+n[i]+" "," ");e.className=r.replace(/^\s+|\s+$/g,"")}else e.className=""}return e},o=function(t){var n={left:0,top:0,width:t.width||t.offsetWidth||0,height:t.height||t.offsetHeight||0,zIndex:1000050},r=e(t,"zIndex");r&&r!="auto"&&(n.zIndex=parseInt(r,10));n.left=$(t).offset().left;while(t){var i=parseInt(e(t,"borderLeftWidth"),10),s=parseInt(e(t,"borderTopWidth"),10);$(t).scrollLeft()&&(n.left+=$(t).scrollLeft()*-1);n.left+=isNaN(i)?0:i;n.top+=isNaN(t.offsetTop)?0:t.offsetTop;n.top+=isNaN(s)?0:s;t=t.offsetParent}return n},u=function(e){return(e.indexOf("?")>=0?"&":"?")+"nocache="+(new Date).getTime()},a=function(e){var t=[];e.trustedDomains&&(typeof e.trustedDomains=="string"?t.push("trustedDomain="+e.trustedDomains):t.push("trustedDomain="+e.trustedDomains.join(",")));return t.join("&")},f=function(e,t){if(t.indexOf)return t.indexOf(e);for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1},l=function(e){if(typeof e=="string")throw new TypeError("ZeroClipboard doesn't accept query strings.");return e.length?e:[e]},c=function(e,t){e&&(c.prototype._singleton||this).glue(e);if(c.prototype._singleton)return c.prototype._singleton;c.prototype._singleton=this;this.options={};for(var n in d)this.options[n]=d[n];for(var r in t)this.options[r]=t[r];this.handlers={};c.detectFlashSupport()&&v()},h,p=[];c.prototype.setCurrent=function(t){h=t;this.reposition();t.getAttribute("title")&&this.setTitle(t.getAttribute("title"));this.setHandCursor(e(t,"cursor")=="pointer")};c.prototype.setText=function(e){if(e&&e!==""){this.options.text=e;this.ready()&&this.flashBridge.setText(e)}};c.prototype.setTitle=function(e){e&&e!==""&&this.htmlBridge.setAttribute("title",e)};c.prototype.setSize=function(e,t){this.ready()&&this.flashBridge.setSize(e,t)};c.prototype.setHandCursor=function(e){this.ready()&&this.flashBridge.setHandCursor(e)};c.version="1.1.7";var d={moviePath:Pb.Data.get("picUrl")+"/flash/ZeroClipboardFV3.swf",trustedDomains:document.location.hostname,text:null,hoverClass:"zeroclipboard-is-hover",activeClass:"zeroclipboard-is-active",allowScriptAccess:"always"};c.setDefaults=function(e){for(var t in e)d[t]=e[t]};c.destroy=function(){c.prototype._singleton.unglue(p);var e=c.prototype._singleton.htmlBridge;e.parentNode.removeChild(e);delete c.prototype._singleton};c.detectFlashSupport=function(){var e=!1;try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")&&(e=!0)}catch(t){navigator.mimeTypes["application/x-shockwave-flash"]&&(e=!0)}return e};var v=function(){var e=c.prototype._singleton,t=document.getElementById("global-zeroclipboard-html-bridge");if(!t){var n='      <object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" id="global-zeroclipboard-flash-bridge" width="100%" height="100%">         <param name="movie" value="'+e.options.moviePath+u(e.options.moviePath)+'"/>         <param name="allowScriptAccess" value="'+e.options.allowScriptAccess+'"/>         <param name="scale" value="exactfit"/>         <param name="loop" value="false"/>         <param name="menu" value="false"/>         <param name="quality" value="best" />         <param name="bgcolor" value="#ffffff"/>         <param name="wmode" value="transparent"/>         <param name="flashvars" value="'+a(e.options)+'"/>         <embed src="'+e.options.moviePath+u(e.options.moviePath)+'"           loop="false" menu="false"           quality="best" bgcolor="#ffffff"           width="100%" height="100%"           name="global-zeroclipboard-flash-bridge"           allowScriptAccess="always"           allowFullScreen="false"           type="application/x-shockwave-flash"           wmode="transparent"           pluginspage="http://www.macromedia.com/go/getflashplayer"           flashvars="'+a(e.options)+'"           scale="exactfit">         </embed>       </object>';t=document.createElement("div");t.id="global-zeroclipboard-html-bridge";t.setAttribute("class","global-zeroclipboard-container");t.setAttribute("data-clipboard-ready",!1);t.style.position="absolute";t.style.left="-9999px";t.style.top="-9999px";t.style.width="15px";t.style.height="15px";t.style.zIndex="1000050";t.innerHTML=n;document.body.appendChild(t)}e.htmlBridge=t;e.flashBridge=document["global-zeroclipboard-flash-bridge"]||t.children[0].lastElementChild};c.prototype.resetBridge=function(){this.htmlBridge.style.left="-9999px";this.htmlBridge.style.top="-9999px";this.htmlBridge.removeAttribute("title");this.htmlBridge.removeAttribute("data-clipboard-text");s(h,this.options.activeClass);h=null;this.options.text=null};c.prototype.ready=function(){var e=this.htmlBridge.getAttribute("data-clipboard-ready");return e==="true"||e===!0};c.prototype.reposition=function(){if(!h)return!1;var e=o(h);this.htmlBridge.style.top=e.top+"px";this.htmlBridge.style.left=e.left+"px";this.htmlBridge.style.width=e.width+"px";this.htmlBridge.style.height=e.height+"px";this.htmlBridge.style.zIndex=e.zIndex+1;this.setSize(e.width,e.height)};c.dispatch=function(e,t){c.prototype._singleton.receiveEvent(e,t)};c.prototype.on=function(e,t){var n=e.toString().split(/\s/g);for(var r=0;r<n.length;r++){e=n[r].toLowerCase().replace(/^on/,"");this.handlers[e]||(this.handlers[e]=t)}this.handlers.noflash&&!c.detectFlashSupport()&&this.receiveEvent("onNoFlash",null)};c.prototype.addEventListener=c.prototype.on;c.prototype.off=function(e,t){var n=e.toString().split(/\s/g);for(var r=0;r<n.length;r++){e=n[r].toLowerCase().replace(/^on/,"");for(var i in this.handlers)i===e&&this.handlers[i]===t&&delete this.handlers[i]}};c.prototype.removeEventListener=c.prototype.off;c.prototype.receiveEvent=function(e,t){e=e.toString().toLowerCase().replace(/^on/,"");var n=h;switch(e){case"load":if(t&&parseFloat(t.flashVersion.replace(",",".").replace(/[^0-9\.]/gi,""))<10){this.receiveEvent("onWrongFlash",{flashVersion:t.flashVersion});return}this.htmlBridge.setAttribute("data-clipboard-ready",!0);break;case"mouseover":i(n,this.options.hoverClass);break;case"mouseout":s(n,this.options.hoverClass);this.resetBridge();break;case"mousedown":i(n,this.options.activeClass);break;case"mouseup":s(n,this.options.activeClass);break;case"datarequested":var r=n.getAttribute("data-clipboard-target"),o=r?document.getElementById(r):null;if(o){var u=$(o).closest(".copycode").attr("data-clipboard-text");u&&this.setText(u)}else{var a=n.getAttribute("data-clipboard-text");a&&this.setText(a)}break;case"complete":this.options.text=null}if(this.handlers[e]){var f=this.handlers[e];typeof f=="function"?f.call(n,this,t):typeof f=="string"&&window[f].call(n,this,t)}};c.prototype.glue=function(e){e=l(e);for(var r=0;r<e.length;r++)if(f(e[r],p)==-1){p.push(e[r]);n(e[r],"mouseover",t)}};c.prototype.unglue=function(e){e=l(e);for(var n=0;n<e.length;n++){r(e[n],"mouseover",t);var i=f(e[n],p);i!=-1&&p.splice(i,1)}};typeof module!="undefined"?module.exports=c:window.ZeroClipboard=c})();var swfobject=function(){function C(){if(b)return;try{var e=a.getElementsByTagName("body")[0].appendChild(U("span"));e.parentNode.removeChild(e)}catch(t){return}b=!0;var n=c.length;for(var r=0;r<n;r++)c[r]()}function k(e){b?e():c[c.length]=e}function L(t){if(typeof u.addEventListener!=e)u.addEventListener("load",t,!1);else if(typeof a.addEventListener!=e)a.addEventListener("load",t,!1);else if(typeof u.attachEvent!=e)z(u,"onload",t);else if(typeof u.onload=="function"){var n=u.onload;u.onload=function(){n();t()}}else u.onload=t}function A(){l?O():M()}function O(){var n=a.getElementsByTagName("body")[0],r=U(t);r.setAttribute("type",i);var s=n.appendChild(r);if(s){var o=0;(function(){if(typeof s.GetVariable!=e){var t=s.GetVariable("$version");if(t){t=t.split(" ")[1].split(",");T.pv=[parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10)]}}else if(o<10){o++;setTimeout(arguments.callee,10);return}n.removeChild(r);s=null;M()})()}else M()}function M(){var t=h.length;if(t>0)for(var n=0;n<t;n++){var r=h[n].id,i=h[n].callbackFn,s={success:!1,id:r};if(T.pv[0]>0){var o=R(r);if(o)if(W(h[n].swfVersion)&&!(T.wk&&T.wk<312)){V(r,!0);if(i){s.success=!0;s.ref=_(r);i(s)}}else if(h[n].expressInstall&&D()){var u={};u.data=h[n].expressInstall;u.width=o.getAttribute("width")||"0";u.height=o.getAttribute("height")||"0";o.getAttribute("class")&&(u.styleclass=o.getAttribute("class"));o.getAttribute("align")&&(u.align=o.getAttribute("align"));var a={},f=o.getElementsByTagName("param"),l=f.length;for(var c=0;c<l;c++)f[c].getAttribute("name").toLowerCase()!="movie"&&(a[f[c].getAttribute("name")]=f[c].getAttribute("value"));P(u,a,r,i)}else{H(o);i&&i(s)}}else{V(r,!0);if(i){var p=_(r);if(p&&typeof p.SetVariable!=e){s.success=!0;s.ref=p}i(s)}}}}function _(n){var r=null,i=R(n);if(i&&i.nodeName=="OBJECT")if(typeof i.SetVariable!=e)r=i;else{var s=i.getElementsByTagName(t)[0];s&&(r=s)}return r}function D(){return!w&&W("6.0.65")&&(T.win||T.mac)&&!(T.wk&&T.wk<312)}function P(t,n,r,i){w=!0;g=i||null;y={success:!1,id:r};var o=R(r);if(o){if(o.nodeName=="OBJECT"){v=B(o);m=null}else{v=o;m=r}t.id=s;if(typeof t.width==e||!/%$/.test(t.width)&&parseInt(t.width,10)<310)t.width="310";if(typeof t.height==e||!/%$/.test(t.height)&&parseInt(t.height,10)<137)t.height="137";a.title=a.title.slice(0,47)+" - Flash Player Installation";var f=T.ie&&T.win?"ActiveX":"PlugIn",l="MMredirectURL="+u.location.toString().replace(/&/g,"%26")+"&MMplayerType="+f+"&MMdoctitle="+a.title;typeof n.flashvars!=e?n.flashvars+="&"+l:n.flashvars=l;if(T.ie&&T.win&&o.readyState!=4){var c=U("div");r+="SWFObjectNew";c.setAttribute("id",r);o.parentNode.insertBefore(c,o);o.style.display="none";(function(){o.readyState==4?o.parentNode.removeChild(o):setTimeout(arguments.callee,10)})()}j(t,n,r)}}function H(e){if(T.ie&&T.win&&e.readyState!=4){var t=U("div");e.parentNode.insertBefore(t,e);t.parentNode.replaceChild(B(e),t);e.style.display="none";(function(){e.readyState==4?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)})()}else e.parentNode.replaceChild(B(e),e)}function B(e){var n=U("div");if(T.win&&T.ie)n.innerHTML=e.innerHTML;else{var r=e.getElementsByTagName(t)[0];if(r){var i=r.childNodes;if(i){var s=i.length;for(var o=0;o<s;o++)(i[o].nodeType!=1||i[o].nodeName!="PARAM")&&i[o].nodeType!=8&&n.appendChild(i[o].cloneNode(!0))}}}return n}function j(n,r,s){var o,u=R(s);if(T.wk&&T.wk<312)return o;if(u){typeof n.id==e&&(n.id=s);if(T.ie&&T.win){var a="";for(var f in n)n[f]!=Object.prototype[f]&&(f.toLowerCase()=="data"?r.movie=n[f]:f.toLowerCase()=="styleclass"?a+=' class="'+n[f]+'"':f.toLowerCase()!="classid"&&(a+=" "+f+'="'+n[f]+'"'));var l="";for(var c in r)r[c]!=Object.prototype[c]&&(l+='<param name="'+c+'" value="'+r[c]+'" />');u.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+a+">"+l+"</object>";p[p.length]=n.id;o=R(n.id)}else{var h=U(t);h.setAttribute("type",i);for(var d in n)n[d]!=Object.prototype[d]&&(d.toLowerCase()=="styleclass"?h.setAttribute("class",n[d]):d.toLowerCase()!="classid"&&h.setAttribute(d,n[d]));for(var v in r)r[v]!=Object.prototype[v]&&v.toLowerCase()!="movie"&&F(h,v,r[v]);u.parentNode.replaceChild(h,u);o=h}}return o}function F(e,t,n){var r=U("param");r.setAttribute("name",t);r.setAttribute("value",n);e.appendChild(r)}function I(e){var t=R(e);if(t&&t.nodeName=="OBJECT")if(T.ie&&T.win){t.style.display="none";(function(){t.readyState==4?q(e):setTimeout(arguments.callee,10)})()}else t.parentNode.removeChild(t)}function q(e){var t=R(e);if(t){for(var n in t)typeof t[n]=="function"&&(t[n]=null);t.parentNode.removeChild(t)}}function R(e){var t=null;try{t=a.getElementById(e)}catch(n){}return t}function U(e){return a.createElement(e)}function z(e,t,n){e.attachEvent(t,n);d[d.length]=[e,t,n]}function W(e){var t=T.pv,n=e.split(".");n[0]=parseInt(n[0],10);n[1]=parseInt(n[1],10)||0;n[2]=parseInt(n[2],10)||0;return t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]?!0:!1}function X(n,r,i,s){if(T.ie&&T.mac)return;var o=a.getElementsByTagName("head")[0];if(!o)return;var u=i&&typeof i=="string"?i:"screen";if(s){E=null;S=null}if(!E||S!=u){var f=U("style");f.setAttribute("type","text/css");f.setAttribute("media",u);E=o.appendChild(f);T.ie&&T.win&&typeof a.styleSheets!=e&&a.styleSheets.length>0&&(E=a.styleSheets[a.styleSheets.length-1]);S=u}T.ie&&T.win?E&&typeof E.addRule==t&&E.addRule(n,r):E&&typeof a.createTextNode!=e&&E.appendChild(a.createTextNode(n+" {"+r+"}"))}function V(e,t){if(!x)return;var n=t?"visible":"hidden";b&&R(e)?R(e).style.visibility=n:X("#"+e,"visibility:"+n)}function $(t){var n=/[\\\"<>\.;]/,r=n.exec(t)!=null;return r&&typeof encodeURIComponent!=e?encodeURIComponent(t):t}var e="undefined",t="object",n="Shockwave Flash",r="ShockwaveFlash.ShockwaveFlash",i="application/x-shockwave-flash",s="SWFObjectExprInst",o="onreadystatechange",u=window,a=document,f=navigator,l=!1,c=[A],h=[],p=[],d=[],v,m,g,y,b=!1,w=!1,E,S,x=!0,T=function(){var s=typeof a.getElementById!=e&&typeof a.getElementsByTagName!=e&&typeof a.createElement!=e,o=f.userAgent.toLowerCase(),c=f.platform.toLowerCase(),h=c?/win/.test(c):/win/.test(o),p=c?/mac/.test(c):/mac/.test(o),d=/webkit/.test(o)?parseFloat(o.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,v=!1,m=[0,0,0],g=null;if(typeof f.plugins!=e&&typeof f.plugins[n]==t){g=f.plugins[n].description;if(g&&(typeof f.mimeTypes==e||!f.mimeTypes[i]||!!f.mimeTypes[i].enabledPlugin)){l=!0;v=!1;g=g.replace(/^.*\s+(\S+\s+\S+$)/,"$1");m[0]=parseInt(g.replace(/^(.*)\..*$/,"$1"),10);m[1]=parseInt(g.replace(/^.*\.(.*)\s.*$/,"$1"),10);m[2]=/[a-zA-Z]/.test(g)?parseInt(g.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else if(typeof u.ActiveXObject!=e)try{var y=new ActiveXObject(r);if(y){g=y.GetVariable("$version");if(g){v=!0;g=g.split(" ")[1].split(",");m=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)]}}}catch(b){}return{w3:s,pv:m,wk:d,ie:v,win:h,mac:p}}(),N=function(){if(!T.w3)return;(typeof a.readyState!=e&&a.readyState=="complete"||typeof a.readyState==e&&(a.getElementsByTagName("body")[0]||a.body))&&C();if(!b){typeof a.addEventListener!=e&&a.addEventListener("DOMContentLoaded",C,!1);if(T.ie&&T.win){a.attachEvent(o,function(){if(a.readyState=="complete"){a.detachEvent(o,arguments.callee);C()}});u==top&&function(){if(b)return;try{a.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}C()}()}T.wk&&function(){if(b)return;if(!/loaded|complete/.test(a.readyState)){setTimeout(arguments.callee,0);return}C()}();L(C)}}(),J=function(){T.ie&&T.win&&window.attachEvent("onunload",function(){var e=d.length;for(var t=0;t<e;t++)d[t][0].detachEvent(d[t][1],d[t][2]);var n=p.length;for(var r=0;r<n;r++)I(p[r]);for(var i in T)T[i]=null;T=null;for(var s in swfobject)swfobject[s]=null;swfobject=null})}();return{registerObject:function(e,t,n,r){if(T.w3&&e&&t){var i={};i.id=e;i.swfVersion=t;i.expressInstall=n;i.callbackFn=r;h[h.length]=i;V(e,!1)}else r&&r({success:!1,id:e})},getObjectById:function(e){if(T.w3)return _(e)},embedSWF:function(n,r,i,s,o,u,a,f,l,c){var h={success:!1,id:r};if(T.w3&&!(T.wk&&T.wk<312)&&n&&r&&i&&s&&o){V(r,!1);k(function(){i+="";s+="";var p={};if(l&&typeof l===t)for(var d in l)p[d]=l[d];p.data=n;p.width=i;p.height=s;var v={};if(f&&typeof f===t)for(var m in f)v[m]=f[m];if(a&&typeof a===t)for(var g in a)typeof v.flashvars!=e?v.flashvars+="&"+g+"="+a[g]:v.flashvars=g+"="+a[g];if(W(o)){var y=j(p,v,r);p.id==r&&V(r,!0);h.success=!0;h.ref=y}else{if(u&&D()){p.data=u;P(p,v,r,c);return}V(r,!0)}c&&c(h)})}else c&&c(h)},switchOffAutoHideShow:function(){x=!1},ua:T,getFlashPlayerVersion:function(){return{major:T.pv[0],minor:T.pv[1],release:T.pv[2]}},hasFlashPlayerVersion:W,createSWF:function(e,t,n){return T.w3?j(e,t,n):undefined},showExpressInstall:function(e,t,n,r){T.w3&&D()&&P(e,t,n,r)},removeSWF:function(e){T.w3&&I(e)},createCSS:function(e,t,n,r){T.w3&&X(e,t,n,r)},addDomLoadEvent:k,addLoadEvent:L,getQueryParamValue:function(e){var t=a.location.search||a.location.hash;if(t){/\?/.test(t)&&(t=t.split("?")[1]);if(e==null)return $(t);var n=t.split("&");for(var r=0;r<n.length;r++)if(n[r].substring(0,n[r].indexOf("="))==e)return $(n[r].substring(n[r].indexOf("=")+1))}return""},expressInstallCallback:function(){if(w){var e=R(s);if(e&&v){e.parentNode.replaceChild(v,e);if(m){V(m,!0);T.ie&&T.win&&(v.style.display="block")}g&&g(y)}w=!1}}}}();$.getObject("Pb.Component.Common.CopyCode",!0).CopyCode=function(){function e(e){var t=e.closest(".zeroclipboard"),n=t.data("tracking"),r=t.data("appboy");n&&Pb.Track.trf(n);r&&r.length&&typeof appboy!="undefined"&&Pb.Data.Shared.get("loggedInUser")&&appboy.logCustomEvent(r)}function t(t){t.attr("readonly",!1);t.click(function(){t.select();e(t)});$(t).on("keydown cut",function(e){e.keyCode!==9&&e.preventDefault()})}function n(n,r){var i=$(n),s=swfobject.getFlashPlayerVersion(),o,u,a,f,l,c,h,p,d;if(i.parents(".privateLinks").length){i.closest("input").prop("disabled","disabled");return}i.closest("input").prop("disabled",!1);if(r||s.major<9){t(i);return}var v=[];f=i.val();l=i.closest(".copycode");c=i.closest(".zeroclipboard");if(!l.length||!c.length){a=n.split(" ");if(a.length===1)p=n.split("_");else{h=a[a.length-1];p=h.split("_")}d=p[0];d.match(/^[.#]/)&&(d=d.substring(1));u=p[2];v.push(document.getElementById(d+"_copycode_"+u))}else v.push(l[0]);if(ZeroClipboard&&v.length){o=new ZeroClipboard(v);o.addEventListener("onComplete",function(t,n){i=$(this).find("input");i.length===0&&(i=$(this).find("textarea"));n.text===i.val()&&i.val("Copied").css("backgroundColor","#FFFF66").fadeTo("normal",.4,function(){$(this).fadeTo("normal",1,function(){$(this).css("backgroundColor","#FFFFFF").val(n.text)});e(i)})})}}return{createZeroClipboard:n}}();(function(){function e(){e.superclass.constructor.call(this)}var t={modal:null,init:function(t){var n={modalId:"#reportModal",modalName:"reportModal",eventName:"ReportModal::show",submitUrl:"/action/flag/media",submitButtonId:"#reportModalSubmitButton"};t&&$.extend(n,t);e.superclass.init.call(this,n);this.initEvents()},initEvents:function(){$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:".showReportModal",eventType:"click",event:this.eventName}}))},bindModalEvents:function(){var t=$(this.modalId);if(t.length){t.find("input[name=type]").on("change",$.proxy(this.onTypeChange,this));e.superclass.bindModalEvents.call(this)}},onShow:function(t){var n=!1;if(t.pbData){t.pbData.fullsizeUrl&&(this.mediaUrl=t.pbData.fullsizeUrl);t.pbData.hashtagMedia&&(n=!0)}this.mediaUrl||(this.mediaUrl=$(t.pbEventTarget).data("url"));this.mediaUrl||(this.mediaUrl=Pb.Data.get("shared.media").fullsizeUrl);e.superclass.onShow.call(this,t);n?$("#reportType input[value=hashtag]").parent().show():$("#reportType input[value=hashtag]").parent().hide()},onHide:function(e){var t=$(this.modalId).find("form");t.length&&t.get(0).reset();this.mediaUrl=null},onSubmit:function(t){t.preventDefault();this.validate()&&e.superclass.onSubmit.call(this,t)},buildSubmitData:function(){var e=$(this.modalId).find("form"),t={type:e.find('input[name="type"]:checked').val(),comment:e.find("#reportComment").val(),email:e.find("#reportEmail").val(),mediaUrl:this.mediaUrl};return t},validate:function(){var e=$(this.modalId).find("form"),t=e.find('input[name="type"]:checked'),n=e.find("#reportComment"),r=e.find("#reportEmail"),i;if(t.val()==="racism"||t.val()==="other"){$(".control-group",this.form).removeClass("error");$(".help-inline",this.form).html("");if(n.val()===""){i="Please provide comments for your report";n.parents(".control-group").addClass("error");n.parents(".controls").find(".help-inline").html(i);return!1}if(r.val()===""){i="Please provide an email address";r.parents(".control-group").addClass("error");r.parents(".controls").find(".help-inline").html(i);return!1}}return!0},onTypeChange:function(e){var t=$(e.currentTarget).val(),n=$(this.modalId);if(t==="nudity"){n.find(".reportExtra").hide();n.find("input[type=submit]").show()}else if(t==="dmca"){n.find(".reportExtra").hide();Pb.Component.Element.Message.show({status:1,message:'If you own the copyright to material on the Photobucket site, please file an official Digital Millennium Copyright Act (DMCA) complaint by following the instructions posted on our <a href="/copyright/" target="_blank">Copyright policy page</a>.'});n.find("input[type=submit]").hide()}else{n.find(".reportExtra").show();n.find("input[type=submit]").show()}}};Pb.subclass(e,Pb.Component.Element.Modal,t);var n=new e;n.init()})();$.getObject("Pb.Component.Search",!0).SearchActions=function(){function e(e){this.init(e)}var t={isLoggedIn:!1,isCompact:!1,isMobile:!1,actionTargetNormalId:"#searchActions",actionTargetCompactId:"#searchActionsCompact",actionTarget:null,actionTemplate:"#searchActionsTemplate",actionData:[],defaultActionData:[],showPagination:!1,eventRegister:null,rotatePostUrl:"/action/media/rotate",searchTerm:null,mode:null,init:function(e){this.isMobile=Pb.Data.get("isMobile");this.defaultActionData=e;this.actionData=$.extend(!0,{},this.defaultActionData);this.actionTarget=$("#searchActions");this.isMobile&&(this.actionTemplate="#searchActionsMobileTemplate");for(var t=0;t<this.actionData.eventRegister.length;t++)$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:this.actionData.eventRegister[t].eventSelector,eventType:this.actionData.eventRegister[t].eventType,event:this.actionData.eventRegister[t].event}}));this.searchTerm=Pb.Data.Shared.get("searchTerm");Pb.Data.Shared.get("recentPageCollectionData")?this.mode="recentUploads":this.mode="search";this.bindActions();this.link();this.fetchShareThis()},bindActions:function(){var e=$(document),t;e.on("SearchActions::facebook",$.proxy(function(e){if(Pb.Data.get("isLoggedIn")){if(this.mode==="search"){t=Pb.Data.Shared.get("shared.searchSetCollection");Pb.Track.trf("search_page_share_facebook_click")}else if(this.mode==="recentUploads"){t={data:{url:e.target.URL,caption:"photobucket.com",title:"Recent Uploads",thumbUrl:Pb.Data.Shared.get("shared.recentSet")[0].thumbUrl,type:"recent"}};Pb.Track.trf("recent_page_share_facebook_click")}$(document).trigger($.Event("Pb.Component.Share.ShareModal::show",{pbData:t,shareType:"facebook",shareMode:this.mode,pbEventTarget:e.currentTarget}));return}e.preventDefault();if(this.mode==="search"){Pb.Track.trf("search_page_share_facebook_click");Pb.Component.Common.Social.Facebook.open(Pb.Data.Shared.get("shared.searchSetCollection").data.url,"search")}else if(this.mode==="recentUploads"){Pb.Track.trf("recent_page_share_facebook_click");Pb.Component.Common.Social.Facebook.open(e.target.URL,"recentUploads")}},this));e.on("SearchActions::gplus",$.proxy(function(e){e.preventDefault();if(this.mode==="search"){Pb.Track.trf("search_page_share_gplus_click");Pb.Component.Common.Social.GooglePlus.open(Pb.Data.Shared.get("shared.searchSetCollection").data.url,"search")}else if(this.mode==="recentUploads"){Pb.Track.trf("recent_page_share_gplus_click");Pb.Component.Common.Social.GooglePlus.open(e.target.URL,"recentUploads")}},this));e.on("SearchActions::pinterest",$.proxy(function(e){e.preventDefault();if(this.mode==="search"){Pb.Track.trf("search_page_share_pinterest_click");Pb.Component.Common.Social.Pinterest.open(Pb.Data.Shared.get("shared.searchSetCollection").data.url,"search",Pb.Data.Shared.get("shared.searchSetCollection").data.items[0].fullsizeUrl)}else if(this.mode==="recentUploads"){Pb.Track.trf("recent_page_share_pinterest_click");Pb.Component.Common.Social.Pinterest.open(e.target.URL,"recentUploads",Pb.Data.Shared.get("shared.recentSetCollection").data.items[0].fullsizeUrl)}},this));e.on("SearchActions::tumblr",$.proxy(function(e){e.preventDefault();if(this.mode==="search"){Pb.Track.trf("search_page_share_tumblr_click");Pb.Component.Common.Social.Tumblr.open(e.target,"search")}else if(this.mode==="recentUploads"){Pb.Track.trf("recent_page_share_tumblr_click");Pb.Component.Common.Social.Tumblr.open(e.target,"recentUploads")}},this));e.on("SearchActions::twitter",$.proxy(function(e){if(Pb.Data.get("isLoggedIn")){if(this.mode==="search"){t=Pb.Data.Shared.get("shared.searchSetCollection");Pb.Track.trf("search_page_share_twitter_click")}else if(this.mode==="recentUploads"){t={data:{url:e.target.URL,caption:"photobucket.com",title:"Recent Uploads",thumbUrl:Pb.Data.Shared.get("shared.recentSet")[0].thumbUrl,type:"recent"}};Pb.Track.trf("recent_page_share_twitter_click")}$(document).trigger($.Event("Pb.Component.Share.ShareModal::show",{pbData:t,shareType:"twitter",shareMode:this.mode,pbEventTarget:e.currentTarget}));return}e.preventDefault();if(this.mode==="search"){Pb.Track.trf("search_page_share_twitter_click");Pb.Component.Common.Social.Twitter.open(Pb.Data.Shared.get("shared.searchSetCollection").data.url,"search")}else if(this.mode==="recentUploads"){Pb.Track.trf("recent_page_share_twitter_click");Pb.Component.Common.Social.Twitter.open(e.target.URL,"recentUploads")}},this));e.on("SearchActions::email",$.proxy(function(e){if(this.mode==="search"){t=Pb.Data.Shared.get("shared.searchSetCollection");Pb.Track.trf("search_page_share_email_click")}else if(this.mode==="recentUploads"){t={data:{url:e.target.URL,caption:"photobucket.com",title:"Recent Uploads",thumbUrl:Pb.Data.Shared.get("shared.recentSet")[0].thumbUrl,type:"recent"}};Pb.Track.trf("recent_page_share_email_click")}$(document).trigger($.Event("Pb.Component.Share.ShareModal::show",{pbData:t,shareType:"email",shareMode:this.mode,pbEventTarget:e.currentTarget}))},this));e.on("SearchActions::links",$.proxy(function(e){if(this.mode==="search"){t=Pb.Data.Shared.get("shared.searchSetCollection");Pb.Track.trf("search_page_share_links_click")}else if(this.mode==="recentUploads"){t={data:{url:e.target.URL,caption:"photobucket.com",title:"Recent Uploads",thumbUrl:Pb.Data.Shared.get("shared.recentSet")[0].thumbUrl,type:"recent"}};Pb.Track.trf("recent_page_share_links_click")}$(document).trigger($.Event("Pb.Component.Share.ShareModal::show",{pbData:t,shareType:"links",shareMode:this.mode,pbEventTarget:e.currentTarget}))},this))},switchToCompactActions:function(){if(this.isCompact)return;this.removeActionTarget();$("#mediaTemplateTarget").append('<div id="searchActionsCompact" class="searchActions searchActionsCompact"></div>');this.actionTarget=$(this.actionTargetCompactId);this.actionTemplate="#searchActionsCompactTemplate";this.link();this.isCompact=!0},switchToNormalActions:function(){if(!this.isCompact)return;this.removeActionTarget();$(".searchfilmstripwrap").before('<div id="searchActions" class="searchActions"></div>');this.actionTarget=$(this.actionTargetNormalId);this.actionTemplate="#searchActionsTemplate";this.bindActions();this.link();this.isCompact=!1},handleMediaContentUpdate:function(e){this.setCurrentMedia(e.newTarget);if(this.isCompact){$("#mediaTemplateTarget").append('<div id="searchActionsCompact" class="searchActions searchActionsCompact"></div>');this.actionTarget=$(this.actionTargetCompactId)}this.link();this.isMobile&&this.actionTarget.find(".btn-social").each($.proxy(function(e,t){var n=$(t).attr("href");n=n.replace(/(\?u=).*/,"?u="+encodeURIComponent(""));n=n.replace(/(\?text=).*/,"?text="+encodeURIComponent(""));$(t).attr("href",n)},this));this.updateShareThis();$(".imageOnly").addClass("hide")},fetchShareThis:function(){typeof stLight=="undefined"&&!this.isMobile?$.ajax({url:"http://w.sharethis.com/button/buttons.js",dataType:"script",success:$.proxy(function(){stLight.options({publisher:"6b3cc47e-c11d-420e-a208-11704eb2c43b"});this.updateShareThis()},this),cache:!0}):this.updateShareThis()},updateShareThis:function(){if(typeof stWidget!="undefined"){var e;this.mode==="search"&&(e=Pb.Data.Shared.get("shared.searchSetCollection").data)}},link:function(){Pb.JSTemplates.link(this.actionTemplate,this.actionTarget,this.actionData)},removeActionTarget:function(){this.actionTarget.off();this.actionTarget.parent()[0].removeChild(this.actionTarget[0])}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Common.Social",!0).Facebook=function(){function e(e,t){e.indexOf("?")>=0?e+="&":e+="?";var n="facebook_share";t&&(n=t+"_"+n);e+="src=pb&evt="+n;FB.ui({method:"share",href:e},function(e){})}return{open:e}}();$.getObject("Pb.Component.Common.Social",!0).Twitter=function(){function e(e,t){e.indexOf("?")>=0?e+="&":e+="?";var n="twitter_share";t&&(n=t+"_"+n);e+="src=pb&evt="+n;e=encodeURIComponent(e);window.open("https://twitter.com/share?url="+e,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600")}return{open:e}}();$.getObject("Pb.Component.Common.Social",!0).Share=function(){function e(){$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:".socialShareAction",eventType:"click",event:"Pb.Component.Common.Social::Share"}}));$(document).on("Pb.Component.Common.Social::Share",$.proxy(function(e){e.preventDefault();var n=$(e.pbEventTarget).data("service"),r=$(e.pbEventTarget).data("mode"),i=document.location;if(e.pbData){i=e.pbData.url;r==="story"&&(i=e.pbData.storyUrl)}t(i,r,n)},this))}function t(e,t,n){switch(n){case"facebook":Pb.Component.Common.Social.Facebook.open(e,t);break;case"gplus":Pb.Component.Common.Social.GooglePlus.open(e,t);break;case"pinterest":Pb.Component.Common.Social.Pinterest.open(e,t,Pb.Data.Albums.getCurrentAlbum().getProperty("thumbUrl"));break;case"tumblr":Pb.Component.Common.Social.Tumblr.open(e,t);break;case"twitter":Pb.Component.Common.Social.Twitter.open(e,t)}}return{open:t,init:e}}();$.getObject("Pb.Component.Common.Login",!0).Register=function(){function e(e){}$.extend(e.prototype,Pb.InputValidator.prototype,{isValid:!1,fetchingSuggestions:!1,registering:!1,init:function(e){this.submitBtn=$("#registerButton");this.form=$("#registerForm");this.password2=$(".modal").find("#password2");this.fields={username:$(".modal").find("#username"),password:$(".modal").find("#password"),email:$("input#email",this.form),gender:$("input#genderM, input#genderF",this.form),birthDate:$("#birthdate").find("select"),birthDay:$("#birthDay",this.form),birthMonth:$("#birthMonth",this.form),birthYear:$("#birthYear",this.form),country:$("#country",this.form)};$(".control-group").each(function(e,t){!$(t).parent(".controls").length});this.initEvents()},initEvents:function(){$(this.form).submit($.proxy(this.onSubmit,this));$("input",this.form).keypress($.proxy(function(e){e.which===13&&this.onSubmit(e)},this));this.submitBtn.on("click",$.proxy(this.onSubmit,this));this.fields.email.on("blur",$.proxy(this.checkEmail,this));this.fields.birthMonth.change($.proxy(this.checkBirthValue,this));this.fields.birthDate.change($.proxy(this.checkBirthValue,this));this.fields.birthYear.change($.proxy(this.preCheckBirthdate,this));this.fields.birthYear.blur($.proxy(this.preCheckBirthdate,this));this.fields.username.blur($.proxy(this.suggest,this)).keyup($.proxy(function(e){var t=$(e.currentTarget).val();t.length>50&&$(e.currentTarget).val(t.substr(0,50))}));this.password2.on("blur",$.proxy(this.handlePasswordBlur,this)).on("click",$.proxy(function(){if(this.password2.val()===this.fields.password.attr("placeholder")||this.password2.val()===""){this.fields.password.show();this.password2.hide();this.fields.password.val(this.password2.val());this.fields.password.focus()}},this)).on("keyup",$.proxy(function(e){this.displayHideLink(e)},this));this.fields.password.on("blur",$.proxy(this.handlePasswordBlur,this)).on("keyup",$.proxy(function(e){this.displayShowLink(e)},this));$(".modal").find("#password").tooltip({trigger:"hover",placement:"right",html:!0});this.fields.password.on("keypress",$.proxy(function(e){var t=String.fromCharCode(e.which);if(t.toUpperCase()===t&&t.toLowerCase()!==t&&!e.shiftKey){this.fields.password.parents(".controls").find(".help-inline").html("Caps lock is on. Passwords are case sensitive.");this.fields.password.parents(".controls").find(".help-inline").css("display","block");this.fields.password.parents(".controls").find(".help-inline").css("margin-top","20px")}else this.fields.password.parents(".controls").find(".help-inline").text()==="Caps lock is on. Passwords are case sensitive."&&this.fields.password.parents(".controls").find(".help-inline").html("")},this));$(".modal").find("#password").after($(".modal").find("#password2"));$("#genderM, #genderF").on("blur change",$.proxy(function(e){$("#genderM").is(":checked")===!1&&$("#genderF").is(":checked")===!1?$("#gender").parents(".control-group").addClass("error"):$("#gender").parents(".control-group").removeClass("error")}));$(".help-inline, .help-mobile").on("click","a",$.proxy(function(e){e.preventDefault();var t=$(e.currentTarget).text();t=t.replace(/ /g,"");$(".modal").find("#username").val(t);$("#greenCheckName").css("display","inline");$("#redXName").css("display","none");$(".modal").find("#username").focus();$(".modal").find("#username").parents(".control-group").removeClass("warning").removeClass("error");$(".modal").find("#username").parents(".controls").find(".help-inline").html("");$(".modal").find("#username").parents(".control-group").find(".help-inline").html("")}));$(".hideLink").click($.proxy(function(e){e.preventDefault();this.fields.password.val(this.password2.val());$(".modal").find("#password").show();$(".modal").find("#password2").hide();this.displayShowLink()},this));$(".showLink").click($.proxy(function(e){e.preventDefault();$(".modal").find("#password2").val($(".modal").find("#password").val());$(".modal").find("#password").hide();$(".modal").find("#password2").show();this.displayHideLink()},this));$("#postalCode").blur($.proxy(this.checkPostal,this));$(".showLink").on("click",$.proxy(this.trackClick,this));$(".hideLink").on("click",$.proxy(this.trackClick,this));$("#registerButton").on("click",$.proxy(this.trackClick,this));$('#registrationForm .arrow, #registrationForm input[type="radio"]').on("mousedown",$.proxy(this.trackClick,this));$('#registrationForm input:not([type="radio"]), #registrationForm select').on("focus",$.proxy(this.trackClick,this));this.attachCaptcha()},attachCaptcha:function(){var e=new Pb.Component.Element.Captcha.Checkbox;e.renderCaptcha(".captchaContainer");$(e.id).on("Pb.Component.Element.Captcha.Checkbox::challenge_solved",$.proxy(this.handleCaptchaCompleted,this))},handleCaptchaCompleted:function(){$("#registerButton").removeAttr("disabled");$("fieldset.captchaContainer").removeClass("error")},handlePasswordBlur:function(e){var t;this.fields.password.is(":visible")?t=this.fields.password.val():t=this.password2.val();this.password2.val(t);this.fields.password.val(t);($(e.target).is("#password")||$(e.target).is("#password2")&&$(e.target).is(":visible"))&&this.validatePassword()},validatePassword:function(){var e=$(".modal").find("#password").val();this.password2.val(e);this.validPassword(e)?this.handleSuccess($(".modal").find("#password")):this.handleError($(".modal").find("#password"),this.messages.password)},displayShowLink:function(){var e=this.fields.password.val();if(e.length&&e!==this.fields.password.attr("placeholder")){$(".hideLink").css("display","none");$(".showLink").css("display","inline")}else this.hidePasswordLinks()},displayHideLink:function(){var e=this.password2.val();if(e.length&&e!==this.fields.password.attr("placeholder")){$(".hideLink").css("display","inline");$(".showLink").css("display","none")}else this.hidePasswordLinks()},hidePasswordLinks:function(){$(".hideLink").css("display","none");$(".showLink").css("display","none")},trackClick:function(e){var t=$(e.currentTarget),n=t.prop("name"),r="reg_modal",i="default";$(".externalSiteRegistration").length!==0&&(i="external");if(n===undefined||n==="")t.hasClass("arrow")?n="slidercaptcha":n="signUpBtn";var s=r+"_"+i+"_"+n+"_focus";Pb.Track.trn(r,s)},checkPostal:function(e){var t="input:text[id=postalCode]",n=$("#country").val();n!=="US"&&n!=="CA"&&this.removeWarning(t);if(!this.validPostalCode($("#postalCode").val())){this.handleError($(t),"");this.isValid=!1}else this.removeWarning(t)},showCongratsMessage:function(){$(".congratsMessage").css("display","block")},preCheckBirthdate:function(e){$(".birthdate.control-group").removeClass("error");$(".birthdate.control-group").find(".help-inline").html("");this.checkBirthdate(e)},checkBirthValue:function(e){var t=$(e.target).val();t===""?this.checkBirthdate(e):$(this.fields.birthDay).val()!==""&&$(this.fields.birthMonth).val()!==""&&$(this.fields.birthYear).val()!==""&&this.checkBirthdate(e)},checkBirthdate:function(e){var t=$("#currentDate").val().split("-");t[2]=parseInt(t[2],10)-13;t[1]=parseInt(t[1],10);t[0]=parseInt(t[0],10);this.handleSuccess(this.fields.birthDate);var n=parseInt($(this.fields.birthYear).val(),10);if($(this.fields.birthDay).val()!==""&&$(this.fields.birthMonth).val()!==""){if(n<t[2])return;if(n===t[2]){var r=parseInt($(this.fields.birthMonth).val(),10);if(r<t[1])return;if(r===t[1]){var i=parseInt($(this.fields.birthDay).val(),10);if(i<=t[0])return}}}var s=$("#birthdate");s.find(".help-inline").remove();s.append('<span class="help-inline"></span>');var o="Must be at least 13 of age.";this.handleError(this.fields.birthDate,o)},checkEmail:function(e){setTimeout($.proxy(function(){var e=this.fields.email.val();if(!this.validEmail(e)){this.handleError(this.fields.email,"");return}Pb.Ajax.ajax({url:"/action/user/checkEmail",data:{email:e},success:$.proxy(function(t){if(t.status){if($(this.fields.username).val().length===0){var n=e.split("@")[0];this.autoPopUsername(n.replace(/[^\w\s]/gi,""))}this.handleSuccess(this.fields.email)}else t.messages&&this.handleError(this.fields.email,"")},this)})},this),0)},checkCaptcha:function(){if($("#g-recaptcha-response").val()===""&&$("#g-recaptcha-response").val().length===0){$(".captchaContainer").addClass("error");this.isValid=!1}},suggest:function(e){var t,n;if(e===undefined){t=this.fields.username[0].value;n=$(".modal").find("#username")}else{t=$(e.target).val();n=$(e.target)}if(!this.fetchingSuggestions&&this.validUsername(t)){this.fetchingSuggestions=!0;Pb.Ajax.ajax({url:"/action/user/suggest",data:{username:t},success:$.proxy(function(e){if(e.status)if(e.data.available){n.parents(".control-group").removeClass("error");n.parent().find(".help-inline").html("");n.parents(".stacked").find(".help-mobile").html("");this.handleSuccess(this.fields.username)}else{var t="Suggestions: ",r=e.messages[0].details.replace(new RegExp("<br>","g")," "),i=t+r;this.handleError(this.fields.username,i)}this.fetchingSuggestions=!1},this),messageHandler:function(){return!0}})}this.validUsername(t)?this.handleSuccess(this.fields.username):this.handleError(this.fields.username,this.messages.username)},autoPopUsername:function(e){Pb.Ajax.ajax({url:"/action/user/suggest",data:{username:e},success:$.proxy(function(t){if(t.status){if(!t.data.available){var n=$($(t.messages[0].details)[2]).text();n=n.replace(/ /g,"");$(this.fields.username).val(n)}else $(this.fields.username).val(e);$(".modal").find("#username").parents(".control-group").removeClass("warning").removeClass("error");$(".modal").find("#username").parents(".controls").find(".help-inline").html("");$(".modal").find("#username").parents(".control-group").find(".help-inline").html("")}},this),messageHandler:function(){return!0}})},removeWarning:function(e){$(e,this.form).parents(".control-group").removeClass("warning").removeClass("error");$(e,this.form).parents(".controls").find(".help-inline").html("");$(e,this.form).parents(".control-group").find(".help-inline").html("")},tip:function(e){$(e.target).tooltip("show")},validate:function(){this.submitBtn.text("Validating...").prop("disabled","disabled");this.isValid=!0;$(".control-group",this.form).removeClass("error");$(".help-inline",this.form).html("");this.validateRequired(this.fields,this.handleRequiredError,this);this.checkPostal();this.checkBirthdate();this.checkCaptcha();this.validEmail(this.fields.email.val())?this.handleSuccess(this.fields.email):this.handleError(this.fields.email,this.messages.email);this.suggest();this.validPassword(this.fields.password.val())?this.handleSuccess(this.fields.password):this.handleError(this.fields.password,this.messages.password)},handleError:function(e,t){e.parents(".control-group").removeClass("success").addClass("error");e.parents(".control-group").find(".help-inline").html(t);e.parents(".stacked").find(".help-mobile").html(t);e.css("background-color","rgb(255, 255, 255);");this.isValid=!1;return!0},handleSuccess:function(e){e.parents(".control-group").addClass("error").removeClass("error").addClass("success");e.parents(".stacked").find(".help-mobile").html("");e.parents(".control-group").find(".help-inline").html("")},handleRequiredError:function(e,t,n){e.parents(".control-group").addClass("error");e.prop("name")==="birthDay"||e.prop("name")==="birthMonth"||e.prop("name")==="birthYear"?$("div.birthdate > .controls > .help-inline").html(t.messages.required):e.parents(".controls").find(".help-inline").html(t.messages.required);n.isValid=!1},onSubmit:function(e){if(!this.registering&&!this.submitBtn.hasClass("disabled")&&this.submitBtn.prop("disabled")!=="disabled"){this.validate();if(this.isValid){this.registering=!0;var t={},n=this.form.serializeArray(),r=0,i=n.length;for(r=0;r<i;r++)t[n[r].name]=n[r].value;Pb.Ajax.ajax({url:"/action/user/register",data:t,success:$.proxy(this.onSuccess,this),messageHandler:$.proxy(function(e){$("#"+e.memo).parents(".control-group").removeClass("success");if(e.memo==="birthDate"){$("#birthdate").parents(".control-group").addClass("error");$("#birthDateGroup").find("> .help-inline").html(e.message);this.submitBtn.text("Create Account").removeAttr("disabled");this.registering=!1;return!0}this.submitBtn.text("Create Account").removeAttr("disabled");this.registering=!1;return!1},this)})}else this.submitBtn.text("Create Account").removeAttr("disabled")}e.preventDefault()},onSuccess:function(e){var t=e.status;if(t&&e.data){Pb.Utilities.cookie("pb_firstlogin",!0);this.handleRegistration(e)}var n=$("#planLevel option:selected").text().split(" - ")[1];Pb.Track.tr("register_"+n+"_submit");this.registering=!1},handleRegistration:function(e){if(!$.isEmptyObject(e.data.redirect)){location.href=e.data.redirect;return}Pb.Component.Element.Message.showDefaultSuccessMessage();if(e.data.returnUrl==="print"){$("#saveProgressLoginModal")&&$("#saveProgressLoginModal").find(".close").click();window.location="/print?action=openPrint"}else window.location=e.data.returnUrl}});var t=new e;Pb.InitEventQueue.addToDomReady(function(){$(document).on("LoginModal::show",$.proxy(function(e,n){t.init()},this)).on("SaveProgressLoginModal::show",$.proxy(function(e,n){t.init()},this))},Pb.InitEventQueue.LOW_PRIORITY);return t}();$.getObject("Pb.Component.Common.Login",!0).Login=function(){function e(e){}$.extend(e.prototype,Pb.InputValidator.prototype,{loggingIn:!1,init:function(){this.loginBtn=$("#loginBtn");this.form=$("#loginForm");this.loggingIn=!1;$(this.form).submit($.proxy(this.onSubmit,this));this.loginBtn.on("click",$.proxy(this.onSubmit,this));$("input",this.form).keypress($.proxy(function(e){e.which===13&&this.onSubmit(e)},this));$("#loginForm").find(".loginHideLink").click($.proxy(function(e){e.preventDefault();$("#loginForm").find("#loginPassword").val($("#loginForm").find("#loginPassword2").val());$("#loginForm").find("#loginPassword").show();$("#loginForm").find("#loginPassword2").hide();this.displayShowLink()},this));$("#loginForm").find(".loginShowLink").click($.proxy(function(e){e.preventDefault();$("#loginForm").find("#loginPassword2").val($("#loginForm").find("#loginPassword").val());$("#loginForm").find("#loginPassword").hide();$("#loginForm").find("#loginPassword2").show();this.displayHideLink()},this))},displayShowLink:function(){$("#loginForm").find(".loginHideLink").css("display","none");$("#loginForm").find(".loginShowLink").css("display","inline")},displayHideLink:function(){$("#loginForm").find(".loginHideLink").css("display","inline");$("#loginForm").find(".loginShowLink").css("display","none")},handleLogin:function(e){if(e.data.redirect==="print"){$("#saveProgressLoginModal")&&$("#saveProgressLoginModal").find(".close").click();window.location="/print?action=openPrint"}else window.location=e.data.redirect},onSuccess:function(e){var t=e.status;t&&e.data&&this.handleLogin(e);Pb.Track.tr("login_submit");this.loggingIn=!1;this.loginBtn.text("Log in")},onSubmit:function(){if(!this.loggingIn){this.loggingIn=!0;this.loginBtn.text("Logging in...");var e={},t=this.form.serializeArray(),n=0,r=t.length;for(n=0;n<r;n++)e[t[n].name]=t[n].value;Pb.Ajax.ajax({url:"/action/auth/login",data:e,success:$.proxy(this.onSuccess,this),messageHandler:$.proxy(function(e){this.loggingIn=!1;this.loginBtn.text("Log in");return!1},this)})}}});var t=new e;Pb.InitEventQueue.addToDomReady(function(){$(document).on("LoginModal::show",$.proxy(function(e,n){t.init()},this)).on("SaveProgressLoginModal::show",$.proxy(function(e,n){t.init()},this))},Pb.InitEventQueue.LOW_PRIORITY);return t}();$.getObject("Pb.Component.Common.Login",!0).SaveProgressLoginModal=function(){function e(t){e.superclass.constructor.call(this)}$.extend(e.prototype,{init:function(t){var n={eventName:"SaveProgressLoginModal::show",modalId:"#saveProgressLoginModal",modalName:"saveProgressLoginModal"};t&&$.extend(n,t);this.authReturnTargetKey="authReturnTarget";this.authReturnTargetEventName="SaveProgressLoginModal::authReturnTarget";e.superclass.init.call(this,n);this.initEvents(n)},initEvents:function(e){$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:".showSaveProgressLoginModal",eventType:"click",event:e.eventName}}));this.initAuthReturnTargetAction()},initAuthReturnTargetAction:function(){this.hasAuthReturnTargetCookie()&&$(document).on(this.authReturnTargetEventName,$.proxy(function(){var e="#"+Pb.Utilities.cookie(this.authReturnTargetKey);if($(e).length>0){$(e).click();Pb.Utilities.cookie(this.authReturnTargetKey,null)}},this))},hasAuthReturnTargetCookie:function(){var e=Pb.Utilities.cookie(this.authReturnTargetKey);return e!==null?!0:!1},onShow:function(t){var n=$(t.pbEventTarget),r,i=$(n).data("authreturntarget");this.hasAuthReturnTargetCookie()&&Pb.Utilities.cookie(this.authReturnTargetKey,null);i!==undefined&&Pb.Utilities.cookie(this.authReturnTargetKey,i,{expires:""});var s=Pb.Data.get(this.modalName);if(s){s.signUp.action=null;s.login.action=null;s.loginUrl="";t.currentTarget?r=t.currentTarget.baseURI:r="print";s.signUp.returnUrl=r;s.login.returnUrl=r;s.login.redirect=r;s.login.facebookLogin.registerUrl=s.login.facebookLogin.registerUrl+"&forwardto="+encodeURIComponent(r+"?action=openPrint");s.login.twitterLogin.registerUrl=s.login.twitterLogin.registerUrl+"&forwardto="+encodeURIComponent(r+"?action=openPrint");t.modalData=s;Pb.Track.tr("save_progress_login_modal_view");e.superclass.onShow.call(this,t);var o=Pb.Data.Shared.get("shared.printProduct"),u=Pb.Data.data.printProductModal?Pb.Data.data.printProductModal:null;if(u){var a=$.cookie("printProductModal");!a&&u.modalData&&Pb.Utilities.cookie("printProductModal",JSON.stringify(u.modalData))}else o&&Pb.Utilities.cookie("printProductModal",JSON.stringify(o));$("#continueLink").on("click",$.proxy(function(e){e.preventDefault();$("#saveProgressLoginModal").find(".close").click();$(document).trigger({type:"PrintLink::Print",printProductTemplateData:u?u.modalData:o})},this))}}});Pb.subclass(e,Pb.Component.Element.Modal,e.prototype);var t=new e;Pb.InitEventQueue.add(function(){t.init()});return t}();window.fbAsyncInit=function(){FB.init({appId:Pb.Data.get("facebookKey"),version:"v2.3",status:!0,cookie:!0,xfbml:!0,oauth:!0,channelUrl:document.location.protocol+"//"+document.domain+"/channel.html"});$(document).trigger("Pb.Component.Facebook.Facebook::fb-init")};(function(e,t,n){var r,i=e.getElementsByTagName(t)[0];if(e.getElementById(n))return;r=e.createElement(t);r.id=n;r.src="//connect.facebook.net/en_US/sdk.js";i.parentNode.insertBefore(r,i)})(document,"script","facebook-jssdk");$.getObject("Pb.Component.Facebook",!0).Facebook=function(){function e(e){var t={};e&&(t.scope=e);FB.login(function(e){if(e.authResponse){var t=e.authResponse;$(document).trigger({type:"Pb.Component.Facebook.Facebook::login",userId:t.userID,accessToken:t.accessToken,signedRequest:t.signedRequest})}else $(document).trigger("Pb.Component.Facebook.Facebook::login-failed")},t)}function t(){FB.logout(function(e){$(document).trigger("Pb.Component.Facebook.Facebook::logout")})}function n(){FB.getLoginStatus(function(e){$(document).trigger({type:"Pb.Component.Facebook.Facebook::login-status",status:e.status,authResponse:e.authResponse})})}function r(e,t){FB.api(e,t)}function i(e,t,n){$.isArray(e)||(e=e.split(","));FB.getLoginStatus(function(r){r.status==="connected"?FB.api("/me/permissions",function(r){var i=r.data,s,o=[],u=[],a;a=i.filter(function(e){return e.status==="granted"});for(s=0;s<a.length;s++)o.push(a[s].permission);for(s=0;s<e.length;s++)o.indexOf(e[s])===-1&&u.push(e[s]);if(u.length){n({status:"error",failedPerms:u});return}t({status:"success",grantedPerms:a})}):r.status==="not_authorized"?n({status:"not_authorized",failedPerms:e}):n({status:"error",failedPerms:e})})}return{login:e,logout:t,getLoginStatus:n,api:r,checkPerms:i}}();(function(){function e(){$("#categories").parents("li").css("width","40%");$("#popular").parents("li").css("width","30%");$("#recent").parents("li").css("width","30%")}Pb.InitEventQueue.addToDomReady(e,10)})();$(document).ready(function(){$(".categoryList .turndownControl").click(function(e){var t=$(this).siblings("UL");if(!$(this).hasClass("turndownClosed")){t.length&&t.slideUp(170);$(this).addClass("turndownClosed")}else{$(this).removeClass("turndownClosed");t.length&&t.slideDown(170)}})});$.getObject("Pb.Component.Common",!0).PageCollection=function(){function e(e){this.init(e)}var t={contentFetchUrl:null,pbDataKey:null,queryObj:null,templateTarget:null,currentPage:null,linked:!1,collectionId:"",currentCollection:null,container:null,allowPrefetch:!0,fetchId:null,init:function(e){this.contentFetchUrl=e.contentFetchUrl;this.queryObj=e.queryObj;this.pbDataKey=e.pbDataKey;this.collectionId=e.collectionId;this.ic=e.ic;Pb.Data.add("collectionId",this.collectionId);Pb.Data.add("collectionKey",this.pbDataKey);var t=e.collectionData;if(t){this.contentFetchUrl=t.contentFetchUrl;this.container=t.container;this.templateTarget=t.templateTarget;this.thumbSize=t.thumbSize}Pb.Data.get("isMobile")&&(this.allowPrefetch=!1);this.bindEvents()},bindEvents:function(){var e=$(document);e.on("Pagination::paginate",$.proxy(this.onPagination,this));e.on("PageCollection::insertFetch",$.proxy(this.onInsertFetch,this));!Pb.Data.data.isMobile&&!Pb.Data.data.storyPage&&!this.ic&&e.on("keyup",{collectionId:this.collectionId},$.debounce(500,$.proxy(this.onKeyUp,this)))},initInfinitePageCollection:function(){if(this.ic){this.currentCollection.data.total===0&&(this.ic.done=!0);this.ic.onLoadMoreViaQuery=$.proxy(this.onLoadMoreViaQuery,this);this.ic.onPageScrolledIntoView=$.proxy(this.onPageScrolledIntoView,this);this.ic.pagedItemsContainer=this.container+" .thumbnail";$(document).on("ThumbnailList::pauseInfiniteCollection",$.proxy(function(){this.ic.pause()},this));$(document).on("ThumbnailList::resumeInfiniteCollection",$.proxy(function(){this.ic.resume()},this));$(".topCircle").on("click",$.proxy(function(e){$("html, body").animate({scrollTop:0},"slow");Pb.Data.get("showAds")&&Pb.Component.Ad.AdRefresh.reloadAds();return!1},this));$(window).scroll(function(){var e=$(".mrec.lazy"),t=$(".topCircle"),n=$("#footer").height()+350;if(Pb.Data.get("showAds"))if($(window).height()<830&&$(document).height()-$(window).scrollTop()<n){var r=$(document).height()-n;e.css("position","absolute");e.css("top",r);t.css("position","absolute");t.css("top",r+280);t.css("margin-left","256px")}else if($(window).scrollTop()>1225){e.css("position","fixed");e.css("top","10px");t.css("top","290px");t.css("position","fixed");t.css("margin-left","256px")}else{e.css("position","relative");e.css("top","0");t.css("position","relative");t.css("top","0");t.css("margin-left","0")}else if($(window).scrollTop()>900){t.css("top","10px");t.css("position","fixed");t.css("margin-left","256px")}else{t.css("position","relative");t.css("top","0");t.css("margin-left","0")}})}},onLoadMoreViaQuery:function(e){var t,n=this.currentCollection.data.offset;e=this.currentCollection.getCurrentPage();t=Math.ceil(n/this.currentCollection.data.pageSize);if(e!==t){t<this.currentCollection.getTotalPages()&&this.prefetchPage(t+1);$(document).trigger($.Event("Pagination::paginate",{pageNumber:e+1,collectionId:this.collectionId,fromFetch:!1}))}else{var r=this.currentCollection,i=$.Deferred();this.fetchId=this.getFetchId();i=this.fetchPage(e+1);i.done($.proxy(function(t){this.ic&&!this.ic.done&&this.handleNewPageData(r,t,e+1,!1)},this))}},onPageScrolledIntoView:function(e){},onKeyUp:function(e){var t=e.target.tagName,n=e.keyCode;if(t==="INPUT"||t==="TEXTAREA")return;if(e.data.collectionId!==this.collectionId)return;if(n===37||n===188){e.stopImmediatePropagation();e.preventDefault();$(".paginationBar:visible:first #previousButton").click();Pb.Track.trf("pagination_previous_keyboard")}else if(n===39||n===190){e.stopImmediatePropagation();e.preventDefault();$(".paginationBar:visible:first #nextButton").click();Pb.Track.trf("pagination_next_keyboard")}},onInsertFetch:function(e){if(e.collectionId===this.collectionId){var t=this.currentCollection.getProperty("currentPage")+1*e.direction,n=(t-1)*this.currentCollection.getPageSize(),r=$.Deferred();if(t<1){t=this.currentCollection.getTotalPages();n=(t-1)*this.currentCollection.getPageSize()}if(t>this.currentCollection.getTotalPages()){t=1;n=0}this.currentCollection.setProperty("currentPage",t);if(this.validatePage(t))$(document).trigger("PageCollection::fetched");else{r=this.fetchPage(t);r.done($.proxy(function(e){if(e&&e.body&&e.body.objects){this.currentCollection.addItemsAtIndex(e.body.objects,n);$(document).trigger("PageCollection::fetched")}},this))}}},onPagination:function(e){e.collectionId===this.collectionId&&(this.ic?this.addPage(e.pageNumber,e.fromFetch):this.goToPage(e.pageNumber,e.fromFetch))},onPaginationFail:function(e){if(e>1){this.goToPage(1);$(document).trigger({type:"Pagination::reset",collectionId:this.collectionId,totalItems:this.currentCollection.getProperty("total"),page:1})}},onPageChanged:function(e,t){},fetchData:function(){var e=this.contentFetchUrl+"?"+this.queryObjToString(),t={url:e,type:"get",data:this.getFetchParams()};return Pb.Ajax.ajax(t)},fetchByIndices:function(e,t){this.queryObj.page=null;this.queryObj.offset=e;this.queryObj.limit=t-e;return this.fetchData()},fetchPage:function(e){this.queryObj.page=e;this.queryObj.offset=null;this.queryObj.limit=this.currentCollection.getPageSize();return this.fetchData()},getFetchParams:function(){return{}},linkCollection:function(){if(!this.linked){var e=Pb.Data.Shared.getPaginated(this.pbDataKey);Pb.JSTemplates.link(this.templateTarget,this.container,e);this.linked=!0}},queryObjToString:function(){var e="",t=this.queryObj;for(var n in t)if(t.hasOwnProperty(n))if($.isPlainObject(t[n])){var r=t[n];for(var i in r)r.hasOwnProperty(i)&&r[i]&&(e+=n+"["+i+"]="+escape(r[i])+"&")}else t[n]&&(e+=n+"="+escape(t[n])+"&");return e},paginate:function(e){this.currentCollection.paginate(e)},calculateNextPage:function(e){var t=this.currentCollection.data.offset,n=this.currentCollection.getCurrentPage(),r=this.currentCollection.getPageSize(),i=$.merge([],this.currentCollection.data.items),s=n*r,o;t===this.currentCollection.data.total&&(r=t-n*r);e===1?o=i.splice(0,r):o=i.splice(s,r);return o},addPage:function(e,t){if(this.ic){var n=$.Deferred(),r;if(this.validatePage(e)){r=this.calculateNextPage(e);if(e===1)$.observable(this.currentCollection.getLinkableCollectionPageData()).insert(0,r);else{var i=(e-1)*this.currentCollection.getPageSize();$.observable(this.currentCollection.getLinkableCollectionPageData()).insert(i,r)}this.currentCollection.setProperty("currentPage",e);$(document).trigger("CollectionData::PageData");this.ic.total=this.currentCollection.data.total;this.ic.moreLoaded(this.currentCollection.data.offset);this.currentPage=e;Pb.Component.Thumbnail&&Pb.Component.Thumbnail.Thumbnail.init();if(this.allowPrefetch){this.fetchId=this.getFetchId();this.prefetchPage(e+1)}this.onPageChanged(this.currentCollection,e);n.resolve()}else if(!t){var s=this.currentCollection;this.fetchId=this.getFetchId();n=this.fetchPage(e);n.done($.proxy(function(t){this.handleNewPageData(s,t,e,!1)},this))}else{this.ic&&(this.ic.working=!1);n.reject()}return n}},goToPage:function(e,t){var n=$.Deferred(),r;!t&&!this.ic&&$.observable(this.currentCollection.getLinkableCollectionPageData()).refresh([]);if(this.currentCollection.hasProperty("total")){r=this.currentCollection.getTotalPages();if(e>r){n.reject();this.onPaginationFail(e);return n}}if(this.validatePage(e)){this.paginate(e);this.pageLoaded!==!1&&this.adjustContainer();this.currentPage=e;Pb.Component.Thumbnail&&Pb.Component.Thumbnail.Thumbnail.init();if(this.allowPrefetch){this.fetchId=this.getFetchId();this.prefetchPage(e+1)}this.onPageChanged(this.currentCollection,e);n.resolve()}else if(!t){if(this.currentCollection.hasProperty("total")&&!this.ic){this.currentCollection.addPlaceholdersForPage(e,this.getPlaceholderTemplateData());this.paginate(e)}var i=this.currentCollection;this.fetchId=this.getFetchId();n=this.fetchPage(e);n.done($.proxy(function(t){this.handleNewPageData(i,t,e,!1)},this))}else n.reject();return n},handleNewPageData:function(e,t,n,r){var i=t.body.objects;e.setProperty("pageSize",parseInt(t.body.pageSize,10));e.setProperty("total",parseInt(t.body.total,10));e.setProperty("mediaCount",parseInt(t.body.total,10)<0?0:parseInt(t.body.total,10));this.addItems(e,i,n,r)},addItems:function(e,t,n,r){var i=(n-1)*e.getPageSize();$.when(e.addItemsAtIndex(t,i)).then($.proxy(function(){!r&&e.getIdentifier()===this.currentCollection.getIdentifier()&&(this.ic?this.addPage(n,!0):this.goToPage(n,!0))},this)).always($.proxy(function(){this.adjustCollectionAd()},this))},adjustCollectionAd:function(){var e=$("#collectionAd"),t=$(this.container).children("#collectionAd");setTimeout($.proxy(function(){e.length&&!t.length&&$(this.container).children("div:eq(11)").after(e)},this),500)},validatePage:function(e){return this.currentCollection.checkPageData(e)},adjustContainer:function(){if($("#libraryNavigation").length>0)$(window).scrollTop($("#libraryNavigation").parent().offset().top);else{var e=$(window).scrollTop();e>50&&$(window).scrollTop(0)}},getPlaceholderTemplateData:function(){var e={pbdkey:this.pbDataKey};return e},resetPagination:function(e){var t={type:"Pagination::reset",totalItems:this.currentCollection.getProperty("total"),collectionId:this.collectionId};e&&(t.pageNumber=e);$(document).trigger(t)},prefetchPage:function(e){var t=this.currentCollection.getTotalPages(),n;if(e<=t&&!this.validatePage(e)){var r=this.currentCollection;n=this.fetchPage(e);n.done($.proxy(function(t){(!this.ic||!this.ic.done)&&this.handleNewPageData(r,t,e,!0)},this))}},getFetchId:function(){return(new Date).getTime()}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Common.PageCollection",!0).SearchPageCollection=function(){function e(e){this.init(e)}var t={thumbSize:null,init:function(t){t=$.extend(t,{pbDataKey:Pb.Data.Shared.SEARCH_SET});e.superclass.init.call(this,t);var n=t.collectionData;if(n){this.container=n.container;this.thumbSize=n.thumbSize;this.currentCollection=new Pb.Data.Collection({identifier:this.collectionId,pageSize:n.pageSize,total:n.total,pbdkey:this.pbDataKey,url:$('link[rel="canonical"]').attr("href"),title:Pb.Data.get("searchTerm")+" photos",description:Pb.Data.get("searchTerm")+" photos"});Pb.Data.Shared.addCollection(this.pbDataKey,this.currentCollection);this.linkCollection();var r=t.collectionData.items.objects;this.addItems(this.currentCollection,r,n.pageNumber)}$(document).trigger("PageCollection::initialized")},getPlaceholderTemplateData:function(){var e=this.thumbSize+"Thumbnail";e+=" dynamicThumbnail";var t={sizeClass:e,pbdkey:this.pbDataKey,id:"",options:{},mediaType:"image"};return t}};Pb.subclass(e,Pb.Component.Common.PageCollection,t);return e}();$.getObject("Pb.Component.Common.Pagination",!0).PaginationBar=function(){function e(e){this.init(e)}var t={init:function(e){this.container=$("#"+e.id);this.pageRangeSize=e.pageRangeSize;this.limit=e.limit;this.infiniteCollection=e.infiniteCollection;this.nextOnly=e.nextOnly;this.allowJumpTo=e.allowJumpTo;this.collectionId=e.collectionId;this.previousButton=e.previousButton;this.nextButton=e.nextButton;this.totalItems=e.total;this.refreshAdsOnPagination=e.refreshAdsOnPagination;this.maxPage=e.maxPage;this.active=e.active;this.paginationData=[];this.currentPage=e.page;this.pageTrackerParams=e.pageTrackerParams||{};this.isMobile=Pb.Data.get("isMobile");this.showButtons=e.showButtons;this.showPageLabel=e.showPageLabel;this.capPageNumbers=e.capPageNumbers;this.updatePaginationControl(e.page);this.active&&this.initPageState();this.initEvents();Pb.JSTemplates.link("#paginationBarTemplate","#"+e.id,this.paginationData)},initEvents:function(){this.container.on("click","a",$.proxy(this.handlePagination,this));this.container.on("submit","form",$.proxy(this.jumpToPage,this));this.container.on("click","input",function(){this.select()});$(document).on("Pagination::reset",$.proxy(this.resetHandler,this));$(document).on("Pagination::paginate",$.proxy(this.paginateHandler,this));typeof History!="undefined"&&typeof History.Adapter!="undefined"&&this.active&&History.Adapter.bind(window,"statechange",$.proxy(this.checkHistory,this));this.registerHelpersForTemplate()},initPageState:function(){if($("#detailModal").is(":visible"))return;var e;if(typeof History!="undefined"){e=this.getPageState(this.currentPage);$(document).trigger($.Event("HistoryManager::updatePageHistory",{replace:!0,state:e,url:e.url,title:e.title}))}},checkHistory:function(e){if($("#detailModal").is(":visible"))return;e.stopImmediatePropagation();var t=History.getState(),n=t.data;if(!n.page)return;n.page!==this.currentPage&&this.paginate(n.page,!0)},reset:function(e,t){t||(t=1);this.totalItems=e;var n=Math.ceil(this.totalItems/this.limit);t>n&&(t=1);this.updatePaginationControl(t);this.setUrl(t)},resetHandler:function(e){this.collectionId===e.collectionId&&this.reset(e.totalItems,e.pageNumber)},updatePaginationControl:function(e){e=parseInt(e,10);var t=Math.ceil(this.totalItems/this.limit),n=(this.pageRangeSize-1)/2,r,i,s=[],o=!0,u=!0,a=!0,f=!0,l=!0,c,h,p,d,v;if($("html").hasClass("is_mobileweb")){o=!1;u=!1}if(t<=1){$.observable(this.paginationData).refresh([{showPagination:!1}]);return}if(this.nextOnly){o=!1;u=!1;l=!1;c=!1}else{if(e-n>=1){r=e-n;r===1&&(o=!1)}else{r=1;o=!1}i=r+this.pageRangeSize-1;if(i>=t){i=t;u=!1;r=t-this.pageRangeSize+1;if(r<=1){r=1;o=!1}}for(p=r;p<=i&&p<=this.maxPage;p++)s.push({pageNumber:p,active:p===e});if(!o||r<=2)a=!1;if(t-1<=i||i>=this.maxPage)f=!1;if(!this.allowJumpTo)l=!1;else if(!a&&!f&&this.showButtons)l=!1;else{d=(""+e).length*10;d<20&&(d=20);d+="px"}if(this.previousButton){c=e!==1;this.previousButton.url=this.getPaginationUrl(e-1);this.previousButton.extraAttributes=' data-page="'+(e-1)+'"'}this.infiniteCollection&&(u=!1)}if(this.nextButton){e!==t&&e<this.maxPage&&(h=e!==t);this.nextButton.url=this.getPaginationUrl(e+1);this.nextButton.extraAttributes=' data-page="'+(e+1)+'"'}t>99&&this.capPageNumbers?v=99:v=t;$.observable(this.paginationData).refresh([{showPagination:!0,numPages:t,mobileNumPages:v,page:e,offset:n,pageRange:s,displayFirstPageNumber:o,displayLastPageNumber:u,showFirstPageSeparator:a,showLastPageSeparator:f,displayJumpTo:l,showPreviousButton:c,showNextButton:h,previousButton:this.previousButton,nextButton:this.nextButton,showPageRange:s.length>0,isMobile:this.isMobile,jumpToWidth:d,showPageLabel:this.showPageLabel}])},paginate:function(e,t){this.container.find("input[name=jumpTo]").removeClass("error");this.currentPage=e;$(document).trigger($.Event("Pagination::paginate",{pageNumber:e,collectionId:this.collectionId}));t||this.setUrl(e)},paginateHandler:function(e){this.collectionId===e.collectionId&&this.updatePaginationControl(e.pageNumber)},getPageState:function(e){var t=this.getPaginationUrl(e),n={},r=e>1?" (page "+e+")":"",i;i=$("html").hasClass("is_ie")?$("title").html():$("title").text();i.match(/ \(page \d+\)/)?i=i.replace(/ \(page \d+\)/,r):i.match(/ \| Photobucket/)&&(i=i.replace(/ \| Photobucket/,r+" | Photobucket"));n={url:t,page:e,title:i};return n},setUrl:function(e){if($("#detailModal").is(":visible"))return;var t;if(typeof History!="undefined"&&typeof History.Adapter!="undefined"){t=this.getPageState(e);$(document).trigger($.Event("HistoryManager::updatePageHistory",{state:t,url:t.url,title:t.title}))}},trackPagination:function(e){var t=[],n=Pb.Data.get("isLoggedIn"),r=n?"_loggedin":"_loggedout";t.push("pagination");t.push("pagination"+r);t.push("pagination_"+this.collectionId);t.push("pagination"+this.collectionId+r);if(e.hasClass("next")||e.parent().hasClass("next")){t.push("pagination_next");t.push("pagination_next_"+this.collectionId);t.push("pagination_next_"+this.collectionId+r)}else if(e.hasClass("previous")||e.parent().hasClass("previous")){t.push("pagination_previous");t.push("pagination_previous_"+this.collectionId);t.push("pagination_previous_"+this.collectionId+r)}else if(e.prop("tagName").toLowerCase()==="input"){t.push("pagination_by_jump_to");t.push("pagination_by_jump_to_"+this.collectionId)}else{t.push("pagination_by_number");t.push("pagination_by_number_"+this.collectionId)}Pb.Track.trf(t.join(","));if(typeof Pb.PageTracker!="undefined"){Pb.PageTracker.trackPageView(this.pageTrackerParams);this.refreshAdsOnPagination&&Pb.Component.Ad.AdRefresh.reloadAds()}},handlePagination:function(e){var t=$(e.currentTarget),n=t.data("page");n&&this.trackPagination(t);if(!this.isMobile){e.preventDefault();n&&this.paginate(n)}},jumpToPage:function(e){e.preventDefault();var t=$(e.target).find("input[name=jumpTo]"),n=t.val(),r;if(n.match(/^\d+$/)&&n>0&&n<=this.maxPage){n=parseInt(n,10);if(n<=Math.ceil(this.totalItems/this.limit)){this.trackPagination(t);if(!this.isMobile){this.paginate(n);return}r=this.getPaginationUrl(n);document.location=r}}t.addClass("error")},registerHelpersForTemplate:function(){$.views.helpers({getPaginationUrl:this.getPaginationUrl})},getPaginationUrl:function(e){var t=location.href,n,r=Pb.Utilities.getQueryParameters(!0),i=0,s="",o;$("#detailModal").is(":visible")&&(t=Pb.Data.get("detailModal").listingPageState.url);t.indexOf("?")>=0?n=t.substring(0,t.indexOf("?")):t.indexOf("#")>=0?n=t.substring(0,t.indexOf("#")):n=t;r.page=e;for(o in r)if(r.hasOwnProperty(o)&&o!=="_suid"){i===0&&(s+="?");i>=1&&(s+="&");s+=o;s+="=";s+=escape(r[o]);i++}return n+s}};$.extend(e.prototype,t);return e}();